!function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=20)}([function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,n){"use strict";function i(t,e){return Math.log(e)/Math.log(t)}e.d=function(t,e){const n=t.indexOf(e);return!(n<0||(t.splice(n,1),0))},e.b=function(t,e,n){const o=i(s,n+1-e);return i(s,t+1-e)/o},e.c=function(t,e,n){const o=i(s,n+1-e);return e+Math.pow(s,t*o)-1},e.a=function(t){for(;null!=t&&t.tabIndex<0&&"body"!=t.nodeName.toLowerCase();)t=t.parentElement;return t||document.body};const s=2},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,n){"use strict";function i(t,e,n){let i=t.target.files;if(!i||i.length<=0)return e("","");const s=i[0],o=new FileReader;o.onload=(t=>e(t.target.result,s)),o[n](s)}e.a=function(t){let e="",n=new Uint8Array(t),i=n.byteLength;for(let t=0;t<i;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)},e.b=function(t){let e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let t=0;t<n;t++)i[t]=e.charCodeAt(t);return i.buffer},e.c=function(){return!window.externalHost&&"download"in $("<a>")[0]},e.d=function(t,e){const n=$("<a>");n.attr("download",t),n.attr("href","data:application/octet-stream;base64,"+btoa(e));const i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});n[0].dispatchEvent(i)},e.f=function(t,e){i(t,e,"readAsText")},e.e=function(t,e){i(t,e,"readAsArrayBuffer")}},function(t,e,n){"use strict";var i=n(10),s=n(11),o=n(1),a=n(12),r=n(4);const c=Math.pow(2,1/12),u=57;e.a=class{constructor(){this.isOut=!1}getInputs(){throw"Error: getInputs() function should be implemented by user"}};class l{constructor(){this.time=0,this.ratio=0}}e.b=class{constructor(t){this.customNodes={},this.paramHandlers={},this.noteHandlers=[],this.portamento=new l,this.ac=t,this.palette=s.a,this.registerCustomNode("createADSR",a.a),this.registerCustomNode("createNoise",a.e),this.registerCustomNode("createNoiseCtrl",a.d),this.registerCustomNode("createLineIn",a.c),this.registerCustomNode("createDetuner",a.b),this.registerParamHandler("BufferDataHandler",new class{constructor(){this.uiRender="renderBufferData"}initialize(t,e){}param2json(t){return r.a(t._encoded)}json2param(t,e){const n=r.b(e);t._encoded=n,t.context.decodeAudioData(n,e=>t._buffer=e)}}),this.registerParamHandler("SoundBankHandler",new class{constructor(){this.uiRender="renderSoundBank"}initialize(t,e){t._buffers=[],t._encodedBuffers=[],t._names=[]}param2json(t){const e=[],n=t._encodedBuffers,i=t._names;for(let t=0;t<i.length;t++)e.push({name:i[t],data:r.a(n[t])});return e}json2param(t,e){const n=t._buffers;n.length=0;const i=t._encodedBuffers;i.length=0;const s=t._names;s.length=0;for(let o=0;o<e.length;o++){const a=e[o];s.push(a.name);const c=r.b(a.data);i.push(c),this.decodeBuffer(t,c,n,o)}}decodeBuffer(t,e,n,i){t.context.decodeAudioData(e,t=>n[i]=t)}})}createAudioNode(t){const e=s.a[t];if(!e)return null;const n=e.custom?this.customNodes:this.ac;if(!e.constructor||!n[e.constructor])return null;const i=n[e.constructor]();return i.context||(i.context=this.ac),this.initNodeParams(i,e,t),i}initNodeData(t,e){t.synth=this,t.type=e;let n=this.createAudioNode(e);if(!n)throw new Error(`No AudioNode found for "${e}"`);t.anode=n,t.nodeDef=this.palette[e];const s=t.nodeDef.noteHandler;return s&&(t.noteHandler=new i.a[s](t),this.addNoteHandler(t.noteHandler)),n}initOutputNodeData(t,e){return t.synth=this,t.type="out",this.outGainNode=this.ac.createGain(),t.anode=this.outGainNode,t.anode.connect(e),t.nodeDef=this.palette.Speaker,t.isOut=!0,t.anode}removeNodeData(t){t.noteHandler&&this.removeNoteHandler(t.noteHandler)}connectNodes(t,e){if(t.nodeDef.control&&!e.nodeDef.control){let n=e.anode;t.controlParams=Object.keys(e.nodeDef.params).filter(t=>n[t]instanceof AudioParam),t.controlParam=t.controlParams[0],t.controlTarget=e.anode,t.anode.connect(n[t.controlParam])}else t.anode.connect(e.anode)}disconnectNodes(t,e){t.nodeDef.control&&!e.nodeDef.control?(t.controlParams=null,t.anode.disconnect(e.anode[t.controlParam])):t.anode.disconnect(e.anode)}json2NodeData(t,e){let n=e;for(const e of Object.keys(t.params)){const i=n.anode[e],s=t.params[e];n.nodeDef.params[e].handler?this.paramHandlers[n.nodeDef.params[e].handler].json2param(n.anode,s):i instanceof AudioParam?(i.value=s,i._value=s):n.anode[e]=s}}nodeData2json(t){const e={};for(const n of Object.keys(t.nodeDef.params)){const i=t.anode[n];t.nodeDef.params[n].handler?e[n]=this.paramHandlers[t.nodeDef.params[n].handler].param2json(t.anode):i instanceof AudioParam?void 0===i._value?e[n]=i.value:e[n]=i._value:e[n]=i}return{type:t.type,params:e,controlParam:t.controlParam,controlParams:t.controlParams}}midi2freqRatio(t){return Math.pow(c,t-u)}noteOn(t,e,n){n||(n=this.ac.currentTime),this.outGainNode.gain.value=e;const i=this.midi2freqRatio(t);this.setupNoteHandlers();for(const s of this.noteHandlers)s.noteOn(t,e,i,n);this.portamento.ratio=i}noteOff(t,e,n){n||(n=this.ac.currentTime);for(const i of this.noteHandlers)i.noteOff(t,e,n)}addNoteHandler(t){this.noteHandlers.push(t)}removeNoteHandler(t){Object(o.d)(this.noteHandlers,t)}setupNoteHandlers(){let t=0;for(const e of this.noteHandlers)e.kbTrigger&&e.releaseTime>t&&(t=e.releaseTime);for(const e of this.noteHandlers)e.kbTrigger||(e.releaseTime=t)}initNodeParams(t,e,n){let i=t;for(const t of Object.keys(e.params||{}))void 0===i[t]?console.warn(`Parameter '${t}' not found for node '${n}'`):i[t]instanceof AudioParam?i[t].value=e.params[t].initial:e.params[t].handler?(e.params[t].phandler=this.paramHandlers[e.params[t].handler||""],e.params[t].phandler.initialize(i,e)):i[t]=e.params[t].initial}registerCustomNode(t,e){this.customNodes[t]=(()=>new e(this.ac))}registerParamHandler(t,e){this.paramHandlers[t]=e}}},function(t,e,n){"use strict";function i(t,e,n,i){a.find(".popup-message").html(t),a.find(".modal-title").text(e||"Alert"),a.find(".popup-ok").hide(),n?a.find(".popup-close").hide():a.find(".popup-close").html("Close"),a.find(".popup-prompt > input").hide(),o=!0,a.one("hidden.bs.modal",t=>o=!1),a.modal(i)}function s(t,e,n,i){let s=!1;a.find(".popup-message").html(t),a.find(".modal-title").text(e||"Please confirm");const r=a.find(".popup-ok");r.show().click(t=>s=!0),a.find(".popup-prompt > input").hide(),a.find(".popup-close").text("Cancel"),a.one("shown.bs.modal",t=>{r.focus(),i&&i()}),a.find("form").one("submit",t=>(s=!0,r.click(),!1)),a.one("hide.bs.modal",t=>{r.off("click"),o=!1,n(s)}),o=!0,a.modal()}n.d(e,"d",function(){return o}),e.g=function(t){o=t},e.a=i,e.e=function(t,e){i(t,e,!0,{keyboard:!1})},e.b=function(){o&&a.find(".popup-ok").click()},e.c=s,e.f=function(t,e,n,i){const o=a.find(".popup-prompt > input");s(t,e,t=>{i&&i(t?o.val():null)},()=>{o.show(),o.focus(),n?(o.val(n),o[0].select()):o.val("")})};let o=!1;const a=$('\n\t<div class="normal-font modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n\t<div class="modal-dialog" role="document">\n\t\t<div class="modal-content">\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\t\t\t<h4 class="modal-title" id="myModalLabel"></h4>\n\t\t</div>\n\t\t<div class="modal-body">\n\t\t\t<div class="popup-message"></div>\n\t\t\t<form class="popup-prompt">\n\t\t\t\t<input type="text" style="width: 100%">\n\t\t\t</form>\n\t\t</div>\n\t\t<div class="modal-footer">\n\t\t\t<button type="button" class="btn btn-default popup-close" data-dismiss="modal"></button>\n\t\t\t<button type="button" class="btn btn-primary popup-ok" data-dismiss="modal">OK</button>\n\t\t</div>\n\t\t</div>\n\t</div>\n\t</div>\n');$("body").append(a)},function(t,e,n){"use strict";e.a=class{constructor(t,e=60,n=.1){this.running=!1,this.ac=t,this.noteDuration=0,this.nextNoteTime=0,this.bpm=e,this.ahead=n}get bpm(){return this._bpm}set bpm(t){this._bpm=t,this.nextNoteTime-=this.noteDuration,this.noteDuration=15/this._bpm,this.nextNoteTime+=this.noteDuration}start(t){this.running||(this.running=!0,t&&(this.cb=t),this.nextNoteTime=this.ac.currentTime,this.tick())}stop(){this.running=!1}tick(){if(this.running)for(requestAnimationFrame(this.tick.bind(this));this.nextNoteTime<this.ac.currentTime+this.ahead;)this.cb&&this.cb(this.nextNoteTime),this.nextNoteTime+=this.noteDuration}}},function(t,e,n){"use strict";var i=n(5);e.a=class{constructor(t,e,n,i){this.pressed=[],this.released=[],this.voices=[];for(let o=0;o<n;o++)this.voices.push(new s(t,e,i)),this.released.push(o);this.portamento=this.voices[0].synth.portamento,e.keyboard&&e.keyboard.portamento&&(this.portamento.time=e.keyboard.portamento);for(let t=1;t<n;t++)this.voices[t].synth.portamento=this.portamento}noteOn(t,e=1,n){const i=this.findVoice(),s=this.voices[i];this.pressed.push(i),s.noteOn(t,e,n)}noteOff(t,e=1,n){for(let i=0;i<this.voices.length;i++){const s=this.voices[i];if(s.lastNote==t){s.noteOff(t,e,n),this.released.push(i);break}}}allNotesOff(){for(const t of this.voices)t.lastNote&&t.noteOff(t.lastNote)}findVoice(){let t;if(this.released.length>0)t=this.released;else{if(!(this.pressed.length>0))throw"This should never happen";t=this.pressed}return t.splice(0,1)[0]}close(){for(const t of this.voices)t.close()}};class s{constructor(t,e,n){this.nodes={},this.loader=new class{constructor(){this.nodes=[]}load(t,e,n,s){const a=new i.b(t);let r=0;for(const t of e.nodes)this.nodes[r++]=new o(t.id);for(let t=0;t<e.nodes.length;t++)for(const n of e.nodes[t].inputs){let e=this.nodeById(n);e&&this.nodes[t].inputs.push(e)}for(let t=0;t<e.nodes.length;t++){const i=e.nodeData[t].type;let o;o="out"==i?a.initOutputNodeData(this.nodes[t],n):a.initNodeData(this.nodes[t],i),a.json2NodeData(e.nodeData[t],this.nodes[t]),this.registerNode(o,s,e.nodes[t].name)}for(const t of this.nodes)for(const e of t.inputs)a.connectNodes(e,t);return this.synth=a,a}nodeById(t){for(const e of this.nodes)if(e.id===t)return e;return null}registerNode(t,e,n){e[n]=t}close(){for(const t of this.nodes)for(const e of t.inputs)this.synth.disconnectNodes(e,t)}},this.synth=this.loader.load(t,e,n||t.destination,this.nodes),this.lastNote=0}noteOn(t,e=1,n){this.synth.noteOn(t,e,n),this.lastNote=t}noteOff(t,e=1,n){this.synth.noteOff(t,e,n),this.lastNote=0}getParameterNode(t,e){let n=this.nodes[t];if(!n)throw new Error(`Node "${t}" not found`);let i=n[e];if(!i)throw new Error(`Parameter "${e}" not found in node "${t}"`);return i}close(){this.lastNote&&this.noteOff(this.lastNote,1),this.loader.close()}}e.b=s;class o extends i.a{constructor(t){super(),this.id=t,this.inputs=[]}getInputs(){return this.inputs}}},function(t,e,n){"use strict";function i(t,e,...n){if(!t&&!r)return;!function(){if(l)return;if(l=!0,navigator.userAgent.indexOf("Firefox")<0)return;let t=$("#walc-log-container"),e=t.height();t.css("height",e+"px")}(),c++>u&&$("#walc-log-content > *:first-child").remove();let i=n.join(", "),s=$("<div>");e?s.html(i):s.text(i),$("#walc-log-content").append(s);$("#walc-log-container").scrollTop(100*u)}function s(t){return t.replace(/\[([^\]\|]+)\|([^\]\|]+)\]/g,(t,e,n)=>`<span class="${e}">${n}</span>`)}function o(t,e){let n=(e?e.time:0)+t.time*t.loopCount-t.latency,i=(n%1).toLocaleString(void 0,{minimumFractionDigits:3,maximumFractionDigits:3}).substr(2),s=((n=Math.floor(n))%60).toLocaleString(void 0,{minimumIntegerDigits:2});return`[log-time|${Math.floor(n/60)}:${s}.${i}]`}e.e=i,e.b=function(t){r=t},e.f=s,e.a=function(){c=0,$("#walc-log-content").empty()},e.d=function(t,e){let n=o(e,t),r=a.a[t.number];r&&r.length<3&&(r+=" "),i(!1,!0,s(`${n} - Note: ${r?`[log-bold|${r}] (${t.number})`:`[log-bold|${t.number}]`} ${`[log-instr|${t.instrument.name}]`} ${`[log-track|${e.name}]`}`))},e.c=function(t,e){i(!1,!0,s(`${o(t)} - ${e}`))};var a=n(14);let r=!0,c=0;const u=1e3;let l=!1},function(t,e,n){"use strict";var i=n(1);class s{constructor(t){this.kbTrigger=!1,this.releaseTime=0,this.ndata=t,this.outTracker=new class{constructor(t){this.outputs=[],this.onBefore(t,"connect",this.connect,(t,e,n)=>{n[0].custom&&n[0].anode&&(n[0]=n[0].anode),t.apply(e,n)}),this.onBefore(t,"disconnect",this.disconnect)}connect(t){this.outputs.push(t)}disconnect(t){Object(i.d)(this.outputs,t)}onBefore(t,e,n,i){const s=t[e],o=this;t[e]=function(){n.apply(o,arguments),i?i(s,t,arguments):s.apply(t,arguments)}}}(t.anode)}noteOn(t,e,n,i){}noteOff(t,e,n){}clone(){let t=this.ndata.nodeDef.constructor;if(!t)return null;const e=this.ndata.anode.context[t]();for(const t of Object.keys(this.ndata.nodeDef.params)){const n=this.ndata.anode[t];n instanceof AudioParam?e[t].value=n.value:null!==n&&void 0!==n&&(e[t]=n)}for(const t of this.outTracker.outputs){let n=t;n.custom&&n.anode&&(n=n.anode),e.connect(n)}for(const t of this.ndata.getInputs())t.anode.connect(e[t.controlParam]);return e}disconnect(t){for(const e of this.outTracker.outputs)t.disconnect(e);for(const e of this.ndata.getInputs())e.anode.disconnect(t[e.controlParam])}rampParam(t,e,n){const i=this.ndata.synth.portamento,s=t.value*e;if(t._value=s,i.time>0&&i.ratio>0){const e=t.value*i.ratio;t.cancelScheduledValues(n),t.linearRampToValueAtTime(e,n),t.exponentialRampToValueAtTime(s,n+i.time)}else t.setValueAtTime(s,n)}}class o extends s{noteOn(t,e,n,i){this.oscClone&&this.oscClone.stop(i),this.oscClone=this.clone(),this.rampParam(this.oscClone.frequency,n,i),this.oscClone.start(i),this.lastNote=t}noteOff(t,e,n){t==this.lastNote&&this.oscClone.stop(n+this.releaseTime)}}class a{constructor(t,e,n,i){this.v1=t,this.v2=e,this.t1=n,this.t2=i}inside(t){return this.t1<this.t2&&this.t1<=t&&t<=this.t2}cut(t){const e=this.v1+(this.v2-this.v1)*(t-this.t1)/(this.t2-this.t1);return new a(this.v1,e,this.t1,t)}run(t,e=!1){this.t2-this.t1<=0?t.setValueAtTime(this.v2,this.t2):(e||t.setValueAtTime(this.v1,this.t1),t.linearRampToValueAtTime(this.v2,this.t2))}}const r={osc:o,buffer:class extends s{noteOn(t,e,n,i){this.absn&&this.absn.stop(i);const s=this.ndata.anode._buffer;if(!s)return;this.absn=this.clone(),this.absn.buffer=s;const o=this.absn.playbackRate;o.value,this.rampParam(o,o.value*n,i),this.absn.start(i),this.lastNote=t}noteOff(t,e,n){t==this.lastNote&&this.absn.stop(n+this.releaseTime)}},ADSR:class extends s{constructor(t){super(t),this.kbTrigger=!0;const e=this.getADSR(),n=e.disconnect;e.disconnect=(t=>{this.loopParams(n=>{n==t&&n.setValueAtTime(n._value,e.context.currentTime)}),n(t)})}getADSR(){return this.ndata.anode}get releaseTime(){return this.getADSR().release}set releaseTime(t){}noteOn(t,e,n,i){this.lastNote=t;const s=this.getADSR();this.loopParams(t=>{const e=this.getParamValue(t),n=(1-s.depth)*e,o=e*s.sustain+n*(1-s.sustain),r=s.context.currentTime;t.cancelScheduledValues(r),i>r&&this.rescheduleRamp(t,t._release,r),t._attack=new a(n,e,i,i+s.attack),t._decay=new a(e,o,i+s.attack,i+s.attack+s.decay),t._attack.run(t),t._decay.run(t,!0)})}noteOff(t,e,n){if(t!=this.lastNote)return;const i=this.getADSR();this.loopParams(t=>{let e=this.getRampValueAtTime(t,n);null===e&&(e=this.getParamValue(t)*i.sustain);const s=(1-i.depth)*e;t.cancelScheduledValues(n);const o=i.context.currentTime;n>o&&(this.rescheduleRamp(t,t._attack,o)||this.rescheduleRamp(t,t._decay,o)),t._release=new a(e,s,n,n+i.release),t._release.run(t)})}rescheduleRamp(t,e,n){return!(!e||!e.inside(n)||(e.cut(n).run(t),0))}getRampValueAtTime(t,e){return t._attack&&t._attack.inside(e)?t._attack.cut(e).v2:t._decay&&t._decay.inside(e)?t._decay.cut(e).v2:null}loopParams(t){for(const e of this.outTracker.outputs)e instanceof AudioParam&&t(e)}getParamValue(t){return void 0===t._value&&(t._value=t.value),t._value}},LFO:class extends o{rampParam(t,e,n){t.setValueAtTime(t.value,n)}},restartable:class extends s{constructor(){super(...arguments),this.playing=!1}noteOn(t,e,n,i){const s=this.ndata.anode;this.playing&&s.stop(i),this.playing=!0,s.start(i),this.lastNote=t}noteOff(t,e,n){t==this.lastNote&&(this.playing=!1,this.ndata.anode.stop(n+this.releaseTime))}},soundBank:class extends s{noteOn(t,e,n,i){const s=this.ndata.anode._buffers,o=this.clone();o.buffer=s[t%s.length],o.start(i)}noteOff(t,e,n){}}};e.a=r},function(t,e,n){"use strict";n.d(e,"a",function(){return s});const i={initial:0,min:-1200,max:1200,linear:!0};let s={Oscillator:{constructor:"createOscillator",noteHandler:"osc",params:{frequency:{initial:220,min:20,max:2e4},detune:i,type:{initial:"sawtooth",choices:["sine","square","sawtooth","triangle"]}}},Buffer:{constructor:"createBufferSource",noteHandler:"buffer",params:{playbackRate:{initial:1,min:0,max:8},detune:i,buffer:{initial:null,handler:"BufferDataHandler"},loop:{initial:!1},loopStart:{initial:0,min:0,max:10},loopEnd:{initial:3,min:0,max:10}}},Noise:{constructor:"createNoise",noteHandler:"restartable",custom:!0,params:{gain:{initial:1,min:0,max:10}}},LineIn:{constructor:"createLineIn",custom:!0,params:{}},SoundBank:{constructor:"createBufferSource",noteHandler:"soundBank",params:{buffer:{initial:null,handler:"SoundBankHandler"}}},Gain:{constructor:"createGain",params:{gain:{initial:1,min:0,max:10,linear:!0}}},Filter:{constructor:"createBiquadFilter",params:{frequency:{initial:440,min:20,max:2e4},Q:{initial:0,min:0,max:100},detune:i,gain:{initial:0,min:-40,max:40,linear:!0},type:{initial:"lowpass",choices:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}}},Delay:{constructor:"createDelay",params:{delayTime:{initial:1,min:0,max:5}}},StereoPan:{constructor:"createStereoPanner",params:{pan:{initial:0,min:-1,max:1,linear:!0}}},Compressor:{constructor:"createDynamicsCompressor",params:{threshold:{initial:-24,min:-100,max:0,linear:!0},knee:{initial:30,min:0,max:40,linear:!0},ratio:{initial:12,min:1,max:20,linear:!0},attack:{initial:.003,min:0,max:1},release:{initial:.25,min:0,max:1}}},Detuner:{constructor:"createDetuner",custom:!0,params:{octave:{initial:0,min:-2,max:2,linear:!0}}},LFO:{constructor:"createOscillator",noteHandler:"LFO",control:!0,params:{frequency:{initial:5,min:.01,max:200},detune:i,type:{initial:"sine",choices:["sine","square","sawtooth","triangle"]}}},GainCtrl:{constructor:"createGain",control:!0,params:{gain:{initial:10,min:0,max:100,linear:!0}}},ADSR:{constructor:"createADSR",noteHandler:"ADSR",control:!0,custom:!0,params:{attack:{initial:.2,min:0,max:10},decay:{initial:.5,min:0,max:10},sustain:{initial:.5,min:0,max:1,linear:!0},release:{initial:1,min:0,max:10},depth:{initial:1,min:0,max:1}}},NoiseCtrl:{constructor:"createNoiseCtrl",control:!0,custom:!0,params:{frequency:{initial:4,min:0,max:200},depth:{initial:20,min:0,max:200}}},Speaker:{constructor:null,params:{}}}},function(t,e,n){"use strict";class i{constructor(){this.custom=!0,this.channelCount=2,this.channelCountMode="max",this.channelInterpretation="speakers",this.numberOfInputs=0,this.numberOfOutputs=1}connect(t,e,n){return t}disconnect(t,e,n){}addEventListener(){}dispatchEvent(t){return!1}removeEventListener(){}}e.a=class extends i{constructor(){super(...arguments),this.attack=.2,this.decay=.5,this.sustain=.5,this.release=1,this.depth=1}};class s extends i{constructor(t){super(),this.gain=1,this.playing=!1,this.anode=t.createScriptProcessor(1024),this.anode.onaudioprocess=(t=>this.processAudio(t))}connect(t){return this.anode.connect(t)}disconnect(){this.anode.disconnect()}start(){this.playing=!0}stop(){this.playing=!1}processAudio(t){}}e.e=class extends s{processAudio(t){for(let e=0;e<t.outputBuffer.numberOfChannels;e++){const n=t.outputBuffer.getChannelData(e);for(let t=0;t<n.length;t++)n[t]=this.playing?this.gain*(2*Math.random()-1):0}}};e.d=class extends s{constructor(t){super(t),this.ac=t,this.frequency=4,this.depth=20,this.sct=0,this.v=0}connect(t){return this.anode.connect(t)}processAudio(t){const e=this.ac.sampleRate/this.frequency;for(let n=0;n<t.outputBuffer.numberOfChannels;n++){let i=t.outputBuffer.getChannelData(n);for(let t=0;t<i.length;t++)this.sct++,this.sct>e&&(this.v=this.depth*(2*Math.random()-1),this.sct=0),i[t]=this.v}}};e.b=class extends s{constructor(){super(...arguments),this.octave=0,this.numberOfInputs=1}processAudio(t){const e=Math.pow(2,this.octave);for(let n=0;n<t.outputBuffer.numberOfChannels;n++){let i=t.outputBuffer.getChannelData(n),s=t.inputBuffer.getChannelData(n),o=0;for(let t=0;t<i.length;t++)i[t]=s[Math.floor(o)],(o+=e)>=s.length&&(o=0)}}};e.c=class extends i{connect(t){if(this.srcNode)return this.srcNode.connect(t),this.dstNode=t,t;const e=window.navigator;e.getUserMedia=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia,e.getUserMedia({audio:!0},e=>{const n=t.context;this.srcNode=n.createMediaStreamSource(e);let i=t;i.custom&&i.anode&&(i=i.anode),this.srcNode.connect(i),this.dstNode=t,this.stream=e},t=>console.error(t))}disconnect(){this.srcNode.disconnect(this.dstNode)}}},function(t,e,n){"use strict";function i(t){let e=Object.getOwnPropertyNames(c);for(let n of e)t(c[n])}n.d(e,"c",function(){return o}),n.d(e,"b",function(){return a}),n.d(e,"h",function(){return r}),n.d(e,"g",function(){return c}),e.e=function(t){t.startTime=t.ac.currentTime,c[t.name]?u[t.name]=t:c[t.name]=t,t.callback(t),t.playing=!0},e.f=function(t,e){i(n=>(function(t,e,n){let i;do{if(i=!1,function(t){if(t.stopped)return!0;if(t.notect<t.notes.length)return!1;if(t.notect=0,t.shouldStop)return t.stopped=!0,t.shouldStop=!1,!0;if(u[t.name]){let e=u[t.name];return e.startTime=t.startTime+t.time,c[t.name]=e,r[t.name]=e,delete u[t.name],!1}if(t.loop){t.startTime+=t.time,t.loopCount++,Object(s.c)(t,`Track [log-track|${t.name}] has looped`),t.notes=[],t.time=0;try{t.callback(t)}catch(e){t.loop=!1,Object(s.e)(!0,!0,Object(s.f)(`[log-bold|Runtime error]: "${e.message}" in track "${t.name}" - looping stopped`)),console.error(e)}return!1}return t.latency=0,t.loopCount++,Object(s.c)(t,`Track [log-track|${t.name}] has ended`),delete c[t.name],delete r[t.name],!0}(e))break;let o=(e=c[e.name]).notes[e.notect];e.startTime+o.time<=n&&(function(t,e,n,i){if(e.options&&function(t){if(t.effect){let e=t.effect;for(let n of Object.getOwnPropertyNames(t))"effect"!=n&&e.param(n,t[n])}else if(t.instrument){let e=t.instrument;for(let n of Object.getOwnPropertyNames(t))"instrument"!=n&&e.param(n,t[n])}}(e.options),e.number<1)return;Object(s.d)(e,t),l(e),e.instrument.noteOn(e.number,e.velocity,i+e.time);let o=e.duration||e.instrument.duration||n.noteDuration;e.instrument.noteOff(e.number,e.velocity,i+e.time+o)}(e,o,t,e.startTime),i=!0,e.notect++)}while(i)})(t,n,e))},e.a=i,e.d=function(t){l=t};var s=n(9);let o={},a={},r={},c={},u={},l=function(t){}},function(t,e,n){"use strict";function i(t,e){let n=o[e];if(!n)throw new Error(`Scale type "${e}" does not exist`);let i=[];for(let e of n)i.push(t+e);return i.ring()}n.d(e,"a",function(){return s}),e.b=function(t,e="major",n=1){if(n<=1)return i(t,e);let s=[].ring();for(let o=0;o<n;o++)s=s.concat(i(t+12*o,e)),o<n-1&&(s=s.butlast());return s};let s={C0:12,Cs0:13,Db0:13,D0:14,Ds0:15,Eb0:15,E0:16,F0:17,Fs0:18,Gb0:18,G0:19,Gs0:20,Ab0:20,A0:21,As0:22,Bb0:22,B0:23,C1:24,Cs1:25,Db1:25,D1:26,Ds1:27,Eb1:27,E1:28,F1:29,Fs1:30,Gb1:30,G1:31,Gs1:32,Ab1:32,A1:33,As1:34,Bb1:34,B1:35,C2:36,Cs2:37,Db2:37,D2:38,Ds2:39,Eb2:39,E2:40,F2:41,Fs2:42,Gb2:42,G2:43,Gs2:44,Ab2:44,A2:45,As2:46,Bb2:46,B2:47,C3:48,Cs3:49,Db3:49,D3:50,Ds3:51,Eb3:51,E3:52,F3:53,Fs3:54,Gb3:54,G3:55,Gs3:56,Ab3:56,A3:57,As3:58,Bb3:58,B3:59,C4:60,Cs4:61,Db4:61,D4:62,Ds4:63,Eb4:63,E4:64,F4:65,Fs4:66,Gb4:66,G4:67,Gs4:68,Ab4:68,A4:69,As4:70,Bb4:70,B4:71,C5:72,Cs5:73,Db5:73,D5:74,Ds5:75,Eb5:75,E5:76,F5:77,Fs5:78,Gb5:78,G5:79,Gs5:80,Ab5:80,A5:81,As5:82,Bb5:82,B5:83,C6:84,Cs6:85,Db6:85,D6:86,Ds6:87,Eb6:87,E6:88,F6:89,Fs6:90,Gb6:90,G6:91,Gs6:92,Ab6:92,A6:93,As6:94,Bb6:94,B6:95,C7:96,Cs7:97,Db7:97,D7:98,Ds7:99,Eb7:99,E7:100,F7:101,Fs7:102,Gb7:102,G7:103,Gs7:104,Ab7:104,A7:105,As7:106,Bb7:106,B7:107,C8:108,Cs8:109,Db8:109,D8:110,Ds8:111,Eb8:111,E8:112,F8:113,Fs8:114,Gb8:114,G8:115,Gs8:116,Ab8:116,A8:117,As8:118,Bb8:118,B8:119};const o={major:[0,2,4,5,7,9,11,12],major_pentatonic:[0,2,4,7,9,12],minor:[0,2,3,5,7,8,10,12],minor_pentatonic:[0,3,5,7,10,12],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11,12]};!function(t){for(let e of Object.getOwnPropertyNames(t))t[t[e]]=e}(s)},function(t,e,n){"use strict";e.a=class{constructor(t,e){this.canvasFFT=this.createCanvas(t),this.gcFFT=this.canvasFFT.getContext("2d"),this.canvasOsc=this.createCanvas(e),this.gcOsc=this.canvasOsc.getContext("2d")}createCanvas(t){const e=$(`<canvas width="${t.width()}" height="${t.height()}">`);return t.append(e),e[0]}createAnalyzerNode(t){this.anode||(this.anode=t.createAnalyser(),this.fftData=new Uint8Array(this.anode.fftSize),this.oscData=new Uint8Array(this.anode.fftSize))}analyze(t){this.disconnect(),this.createAnalyzerNode(t.context),this.input=t,this.input.connect(this.anode),this.requestAnimationFrame()}disconnect(){this.input&&(this.input.disconnect(this.anode),this.input=null)}requestAnimationFrame(){window.requestAnimationFrame(t=>this.updateCanvas())}updateCanvas(){this.input&&(this.gcFFT&&this.drawFFT(this.gcFFT,this.canvasFFT,this.fftData,"#00FF00"),this.gcOsc&&this.drawOsc(this.gcOsc,this.canvasOsc,this.oscData,"#FFFF00"),this.requestAnimationFrame())}drawFFT(t,e,n,i){const[s,o]=this.setupDraw(t,e,n,i);this.anode.getByteFrequencyData(n);const a=n.length/2/e.width;let r=0;for(let e=0;e<s;e++){let i=n[Math.floor(r)];r+=a,t.moveTo(e,o-1),t.lineTo(e,o-1-o*i/256)}t.stroke(),t.closePath()}drawOsc(t,e,n,i){const[s,o]=this.setupDraw(t,e,n,i);this.anode.getByteTimeDomainData(n),t.moveTo(0,o/2);let a=0;for(;n[a]>128&&a<n.length/4;)a++;for(;n[a]<128&&a<n.length/4;)a++;const r=.75*n.length/e.width;for(let e=0;e<s;e++){let i=n[Math.floor(a)];a+=r,t.lineTo(e,o*i/256)}t.stroke(),t.closePath()}setupDraw(t,e,n,i){const s=e.width,o=e.height;return t.clearRect(0,0,s,o),t.beginPath(),t.strokeStyle=i,[s,o]}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function byId(t){return document.getElementById(t)||sinkDiv}function loadMonaco(t){monacoRequire.config({paths:{vs:"js/vendor/monaco/min/vs"}}),monacoRequire(["vs/editor/editor.main"],t)}function createEditor(t,e,n){return setupGlobals(new __WEBPACK_IMPORTED_MODULE_0__live_coding__.a(t,e,n)),_synthUI=n,new Promise(t=>loadMonaco(()=>t(setupEditor())))}function setupEditor(){let t=byId("walc-code-editor");return setupDefinitions(),editor=monaco.editor.create(t,{value:"",language:"typescript",lineNumbers:!1,renderLineHighlight:"none",minimap:{enabled:!1}}),handleEditorResize(t),Object(__WEBPACK_IMPORTED_MODULE_1__editor_actions__.a)(editor),editor.focus(),Object(__WEBPACK_IMPORTED_MODULE_5__editor_buffers__.a)(editor),setupCompletion(),$(document).on("route:show",(t,e)=>{"#live-coding"==e&&(editor.focus(),window.scrollTo(0,0))}),analyzer=new __WEBPACK_IMPORTED_MODULE_6__synthUI_analyzer__.a($("#walc-graph-fft"),$("#walc-graph-osc")),editor}function setupGlobals(t){global.lc=t,global.instruments=__WEBPACK_IMPORTED_MODULE_8__scheduler__.c,global.effects=__WEBPACK_IMPORTED_MODULE_8__scheduler__.b,global.tracks=__WEBPACK_IMPORTED_MODULE_8__scheduler__.h,global.Note=__WEBPACK_IMPORTED_MODULE_3__scales__.a,global.random=__WEBPACK_IMPORTED_MODULE_4__random__.a,global.p5=global,global.global={},Object(__WEBPACK_IMPORTED_MODULE_2__rings__.a)()}function addTypeScriptDefinitions(t){monaco.languages.typescript.typescriptDefaults.addExtraLib(t)}function setupDefinitions(){fetch("js/lc-definitions.ts").then(t=>t.text()).then(addTypeScriptDefinitions),document.location.pathname.endsWith("p5j.html")&&fetch("js/p5.d.ts").then(t=>t.text()).then(addTypeScriptDefinitions)}function createProposals(t,e){let n=[];t.endsWith("s")&&(t=t.substr(0,t.length-1));for(let i in e)n.push({label:i,kind:monaco.languages.CompletionItemKind.Field,documentation:`The ${i} ${t}`,insertText:i});return n}function setupCompletion(){monaco.languages.registerCompletionItemProvider("typescript",{provideCompletionItems:function(t,e){let n=e.lineNumber,i=t.getValueInRange({startLineNumber:n,startColumn:1,endLineNumber:n,endColumn:e.column}),s={instruments:__WEBPACK_IMPORTED_MODULE_8__scheduler__.c,effects:__WEBPACK_IMPORTED_MODULE_8__scheduler__.b,tracks:__WEBPACK_IMPORTED_MODULE_8__scheduler__.h,global:global};for(let t in s)if(i.endsWith(t+"."))return createProposals(t,s[t]);return[]}})}function handleEditorResize(t){let e=t.clientWidth;setInterval(n=>{let i=t.clientWidth;e!=i&&(e=i,editor.layout())},1e3)}function setupAnalyzers(){analyzer.analyze(_synthUI.outNode)}function getRuntimeErrorDecoration(t){let e=editor.getLineDecorations(t);if(!e||e.length<=0)return null;for(let t of e)if("walc-error"==t.options.className)return t;return null}function getErrorLocation(t){if(t.line)return{line:t.line,column:t.column};if(!t.stack)return null;let e=t.stack.match(/(<anonymous>|> eval):(\d+):(\d+)/);return e&&4==e.length?{line:parseInt(e[2],10),column:parseInt(e[3],10)}:null}function showError(t,e,n){Object(__WEBPACK_IMPORTED_MODULE_7__log__.e)(!0,!0,Object(__WEBPACK_IMPORTED_MODULE_7__log__.f)(`[log-bold|Runtime error]: "${t}" at line ${e}, column ${n}`)),editor.revealLineInCenter(e);let i=getErrorRange(editor.getModel().getLineContent(e),n);return decorations=editor.deltaDecorations(decorations,[{range:new monaco.Range(e,i.from,e,i.to),options:{isWholeLine:!1,className:"walc-error",hoverMessage:["**Runtime Error**",t]}}]),i}function getErrorRange(t,e){let n=(t=t.substring(e-1)).match(/\s*[\w_$]+/);return n&&void 0!==n.index&&n[0]?{from:e+n.index,to:e+n.index+n[0].length}:{from:0,to:t.length+1}}function flashRange(t){let e=[];e=editor.deltaDecorations(e,[{range:t,options:{isWholeLine:!1,className:"walc-running"}}]),setTimeout(t=>{$(".walc-running").css("background-color","inherit"),setTimeout(()=>{e=editor.deltaDecorations(e,[])},1e3)},100)}function doRunCode(code){__WEBPACK_IMPORTED_MODULE_4__random__.a.seed(__WEBPACK_IMPORTED_MODULE_4__random__.a.seed()),setupAnalyzers();try{decorations=editor.deltaDecorations(decorations,[]),eval(code)}catch(t){let e=getErrorLocation(t);e&&showError(t.message,e.line,e.column)}}__webpack_exports__.a=createEditor,__webpack_exports__.c=flashRange,__webpack_exports__.b=doRunCode;var __WEBPACK_IMPORTED_MODULE_0__live_coding__=__webpack_require__(31),__WEBPACK_IMPORTED_MODULE_1__editor_actions__=__webpack_require__(36),__WEBPACK_IMPORTED_MODULE_2__rings__=__webpack_require__(37),__WEBPACK_IMPORTED_MODULE_3__scales__=__webpack_require__(14),__WEBPACK_IMPORTED_MODULE_4__random__=__webpack_require__(19),__WEBPACK_IMPORTED_MODULE_5__editor_buffers__=__webpack_require__(18),__WEBPACK_IMPORTED_MODULE_6__synthUI_analyzer__=__webpack_require__(15),__WEBPACK_IMPORTED_MODULE_7__log__=__webpack_require__(9),__WEBPACK_IMPORTED_MODULE_8__scheduler__=__webpack_require__(13);let sinkDiv=document.createElement("div"),global=window,monacoRequire=global.require,editor,_synthUI,analyzer,decorations=[]},function(t,e,n){"use strict";function i(t,e,n,i=4){let s=function(t,e){if("number"==typeof e){let n=t.presets.length;if(e<1||e>n)throw new Error(`The preset number should be between 1 and ${n}`);return t.presets[e-1]}if("string"==typeof e){for(let n of t.presets)if(n.name==e)return n;throw new Error(`Preset "${e}" does not exist`)}return e}(t.presets,e),r=new class extends a.a{initialize(){return u(this,void 0,void 0,function*(){o(this.name)})}shutdown(){}param(t,e,n,i=!0){let s=t.split("/");if(s.length<2)throw new Error('Instrument parameters require "node/param" format');let o=s[0],a=s[1];if(void 0===e){let t=this.voices[0].getParameterNode(o,a);return t.value}for(let t of this.voices){let s=t.getParameterNode(o,a);this.updateValue(s,e,n,i)}return this}paramNames(){let t=[],e=this.voices[0];for(let n of Object.getOwnPropertyNames(e.nodes))for(let i in e.nodes[n])e.nodes[n][i]instanceof AudioParam&&t.push(n+"/"+i);return t}connect(t){for(let e of this.voices)e.synth.outGainNode.disconnect(),e.synth.outGainNode.connect(t)}updateValue(t,e,n,i=!0){if(void 0===n)t._value=e,t.value=e;else{let s=this.voices[0].synth.ac;i?t.exponentialRampToValueAtTime(e,s.currentTime+n):t.linearRampToValueAtTime(e,s.currentTime+n)}}}(t.context,s,i,t.synthUI.outNode);return r.name=n||s.name,r.duration=function(t){let e=0;for(let n of t.nodeData)if("ADSR"==n.type){let t=n.params.attack+n.params.decay;t>e&&(e=t)}e&&(e+=.01);return e}(s),r}function s(t){return Object(c.e)(!0,!0,Object(c.f)(t))}function o(t){s(`Instrument [log-instr|${t}] ready`)}e.a=function(t,e,n,s=4){if("string"!=typeof e)return i(t,e,n,s);e.indexOf("/")<0&&(e="Modulator/"+e);let[o,a]=e.split("/"),r=l[o];if(!r)throw new Error(`Instrument '${e}' not found: unknown prefix '${r}'`);return r(t,a,n,s)},e.b=function(t){for(let e=0;e<t.length;e++)!function(t){u(this,void 0,void 0,function*(){if(!t.type.startsWith("audio/"))return s(`[log-bold|Error]: file ${t.name} is not an audio file`);let e=function(t){let e=t.lastIndexOf(".");return e<=0?t:t.substr(0,e)}(t.name);s(`Loading sample [log-instr|${e}]...`);let n=yield function(t){return u(this,void 0,void 0,function*(){return new Promise(e=>{let n=new FileReader;n.onload=(t=>e(t.target.result)),n.readAsArrayBuffer(t)})})}(t),i=yield function(t){return u(this,void 0,void 0,function*(){return new Promise(e=>{f.decodeAudioData(t,e)})})}(n);d[e]=i,s(`Sample [log-instr|${e}] ready`)})}(t[e])};var a=n(8),r=n(35),c=n(9),u=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(a,r)}c((i=i.apply(t,e||[])).next())})};let l={Modulator:i,wavetable:function(t,e,n,i=4){return new class{constructor(t,e,n){this.ctx=t,this.presetName=e,this.envelopes=[],this.duration=0,void 0===n&&(n=e),this.name=n}initialize(){return u(this,void 0,void 0,function*(){s(`Loading instrument [log-instr|${this.name}]...`),this.preset=yield this.loadInstrument(this.presetName),o(this.name)})}shutdown(){h.expireEnvelopes(this.ctx)}param(t,e,n,i=!0){return this}paramNames(){return[]}connect(t){this.destination=t}noteOn(t,e,n){void 0===n&&(n=this.ctx.currentTime);let i=h.queueWaveTable(this.ctx,this.destination,this.preset,n,t,9999,e);this.envelopes[t]=i}noteOff(t,e,n){let i=this.envelopes[t];i&&i.cancel(n)}adjustPreset(t){return u(this,void 0,void 0,function*(){return new Promise(e=>h.adjustPreset(this.ctx,t,e))})}fetchPreset(t){return u(this,void 0,void 0,function*(){let e=yield fetch(this.getURL(t,"_sf2_file"));if(e.ok||(e=yield fetch(this.getURL(t,"_sf2"))),!e.ok){let e=`wavetable preset '${t}' not found`;throw s("[log-bold|Error]: "+e),new Error(e)}let n=yield e.json();return n})}loadInstrument(t){return u(this,void 0,void 0,function*(){let e=yield this.fetchPreset(t);return yield this.adjustPreset(e),e})}getURL(t,e){return t.endsWith("_sf2_file")||t.endsWith("_sf2")||(t+=e),`wavetables/${t}.json`}}(t.context,e,n)},sample:function(t,e,n,i=4){return new class{constructor(t,e,n){if(this.ctx=t,this.baseNote=69,this.ignoreNote=!0,this.loops=1,this.loopStart=0,this.loopEnd=1e3,this.buffer=d[e],!this.buffer)throw new Error(`Sample '${e}' not found`);this.name=n||e,this.duration=this.buffer.duration,this.loopEnd=this.duration}initialize(){return u(this,void 0,void 0,function*(){o(this.name)})}shutdown(){}param(t,e,n,i){if(this.paramNames().indexOf(t)<0)throw new Error(`Parameter '${t}' not found in instrument '${this.name}'`);return void 0===e?this[t]:(this[t]=e,this)}paramNames(){return["baseNote","ignoreNote","loops","loopStart","loopEnd"]}noteOn(t,e,n){let i=this.ctx.createBufferSource();this.src=i,i.buffer=this.buffer;let s=this.connectGain(e);i.connect(s);let o=this.ignoreNote?1:this.midi2Ratio(t);i.playbackRate.value=o,this.duration=this.buffer.duration/o,this.setupLooping(o),i.start(n)}noteOff(t,e,n){this.src.stop(n)}connect(t){this.destination=t}midi2Ratio(t){const e=Math.pow(2,1/12);return Math.pow(e,t-this.baseNote)}connectGain(t){let e=this.destination;if(1==t)return e;let n=this.ctx.createGain();return n.gain.value=t,n.connect(e),n}setupLooping(t){1!=this.loops&&(this.src.loop=!0,this.src.loopStart=this.loopStart,this.src.loopEnd=this.loopEnd,this.duration=this.loopEnd+(this.loopEnd-this.loopStart)*(this.loops-1),this.duration=this.duration/t)}}(t.context,e,n)}};let h=new r.a,d={},f=new AudioContext},function(t,e,n){"use strict";function i(t){return $("#walc-buffer-"+t)}function s(t,e){!function(t,e){i(t).removeClass("btn-info").addClass("btn-primary"),i(e).removeClass("btn-primary").addClass("btn-info")}(u,t),o(u,e),a(t,e),u=t,localStorage.setItem("code_buffer_selected",""+u),e.focus()}function o(t,e){let n=r(e);localStorage.setItem("code_buffer_"+t,n);let i={fontSize:e.getConfiguration().fontInfo.fontSize,position:e.getPosition()};localStorage.setItem("code_buffer_prefs_"+t,JSON.stringify(i))}function a(t,e){!function(t,e){t.getModel().setValue(e)}(e,localStorage.getItem("code_buffer_"+t)||"");let n=localStorage.getItem("code_buffer_prefs_"+t);if(n){let t=JSON.parse(n);e.setPosition(t.position),e.revealPositionInCenterIfOutsideViewport(t.position),e.updateOptions({fontSize:t.fontSize})}}function r(t){return t.getModel().getValue()}e.a=function(t){!function(t){a(u,t),function(t){let e=r(t),n=t.getPosition();setInterval(()=>{let i=r(t),s=t.getPosition();e==i&&n.lineNumber==s.lineNumber&&n.column==s.column||(o(u,t),e=i,n=s)},1e3)}(t)}(t);for(let e=1;e<=c;e++)!function(t,e){i(t).click(n=>s(t,e))}(e,t);!function(t){let e=localStorage.getItem("code_buffer_selected")||"1",n=parseInt(e,10);isNaN(n)||s(n,t)}(t)},e.c=function(t){let e=u-1;e<1&&(e=c),s(e,t)},e.b=function(t){let e=u+1;e>c&&(e=1),s(e,t)};const c=8;let u=1},function(t,e,n){"use strict";function i(t){let e=(t+123456789).toString();o=s(e),r=t}n.d(e,"a",function(){return a});const s=n(38);let o,a={seed:t=>(void 0!==t&&i(t),r),float:(t,e)=>void 0===e?o()*t:t+o()*(e-t),integer:(t,e)=>t+Math.floor(o()*(e-t+1)),dice(t){return this.integer(1,t)},one_in(t){return 1===this.dice(t)},choose(...t){let e=[];for(let n of t)e=e.concat(n);return e[this.dice(e.length)-1]}},r=0;i(0)},function(t,e,n){t.exports=n(21)},function(t,e,n){"use strict";function i(){$(function(){let t=$(".nano");t.nanoScroller({preventPageScrolling:!0})});const t=new a.a(f),e=new r.a(f);return e.beforeSave=(e=>$.extend(e,{keyboard:t.piano.toJSON()})),e.afterLoad=(e=>t.piano.fromJSON(e.keyboard)),$(function(){$("#synth").focus()}),$(document).on("route:show",(t,n)=>{"#synth"==n&&e.selectBestNode()}),Object(c.a)(d,e,f)}function s(t){if(!location.search||location.search.length<=0||!location.search.startsWith("?"))return;let e=location.search.substr(1).split("&"),n={};for(let t of e){let[e,i]=t.split("=");n[e]=i}!function(t,e){t.codeURL&&function(t,e){l(this,void 0,void 0,function*(){let n=yield fetch(t);if(!n.ok)return;let i=yield n.text();location.hash="#live-coding";let s=e.getModel().getValue()||"";s.trim().length>0&&!s.trim().startsWith("/*")&&(s="\n/*\n"+s+"\n*/\n"),e.getModel().setValue(i+s)})}(t.codeURL,e)}(n,t)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(22),a=n(25),r=n(30),c=n(16),u=n(47),l=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(a,r)}c((i=i.apply(t,e||[])).next())})};let h,d,f;Object(u.a)("#synth").then(t=>{h=$("#graph-canvas")[0],d=new(window.AudioContext||window.webkitAudioContext),f=new o.a(d,h,$("#node-params"),$("#audio-graph-fft"),$("#audio-graph-osc")),i().then(t=>s(t))})},function(t,e,n){"use strict";function i(t,e){const n=$("<div>").addClass(t);$("body").append(n);const i=n.css(e);return n.remove(),i}var s=n(23),o=n(5),a=n(1),r=n(6),c=n(24),u=n(15);e.a=class{constructor(t,e,n,l,h){this.gr=new s.a(e),this.gr.handler=new class{constructor(t,e,n,s){this.synthUI=t,this.jqParams=e,this.arrowColor=i("arrow","color"),this.ctrlArrowColor=i("arrow-ctrl","color"),this.registerNodeDelete(e.parent()[0]),this.analyzer=new u.a(n,s)}registerNodeDelete(t){$(Object(a.a)(t)).keydown(t=>{if(!(46==t.keyCode||8==t.keyCode&&t.metaKey))return;if(r.d)return;const e=this.getSelectedNode();e&&(e.data.isOut||r.c("Delete node?","Please confirm node deletion",t=>{t&&(this.synthUI.removeNode(e),this.jqParams.empty())}))})}getSelectedNode(){for(const t of this.synthUI.gr.nodes)if(t.element.hasClass("selected"))return t;return null}hasAudioParams(t){const e=Object.keys(t.nodeDef.params).filter(e=>t.anode[e]instanceof AudioParam);return e.length>0}canBeSource(t){const e=t.data;return e.anode!=this.synthUI.outNode}canConnect(t,e){const n=t.data,i=e.data;return n.nodeDef.control?this.hasAudioParams(i):i.anode.numberOfInputs>0}connected(t,e){this.synthUI.synth.connectNodes(t.data,e.data)}disconnected(t,e){this.synthUI.synth.disconnectNodes(t.data,e.data)}nodeSelected(t){const e=t.data;Object(c.a)(e,this.jqParams)}nodeRemoved(t){this.synthUI.removeNodeData(t.data)}getArrowColor(t,e){const n=t.data;return n.nodeDef.control?this.ctrlArrowColor:this.arrowColor}data2json(t){return this.synthUI.synth.nodeData2json(t.data)}json2data(t,e){this.synthUI.createNodeData(t,e.type),this.synthUI.synth.json2NodeData(e,t.data)}graphLoaded(){this.analyzer.analyze(this.synthUI.outNode)}graphSaved(){}}(this,n,l,h),this.synth=new o.b(t),this.registerPaletteHandler(),this.addOutputNode()}addOutputNode(){const t=new s.b(500,210,"Out");t.data=new l(t),this.synth.initOutputNodeData(t.data,this.synth.ac.destination),this.outNode=t.data.anode,this.gr.addNode(t,"node-out"),this.initNodeDimensions(t)}registerPaletteHandler(){let t=this;$(".palette .node").click(function(e){let n=$(this),i=(n.attr("class")||"").split(/\s+/).filter(t=>"node"!=t),s=n.attr("data-type");s&&t.addNode(s,n.find(".node-text").html(),i.join(" "))})}addNode(t,e,n){let{x:i,y:o}=this.findFreeSpot();const a=new s.b(i,o,e);this.createNodeData(a,t),this.gr.addNode(a,n),this.gr.selectNode(a)}removeNode(t){this.gr.removeNode(t)}removeNodeData(t){this.synth.removeNodeData(t)}createNodeData(t,e){t.data=new l(t),"out"==e?(this.synth.initOutputNodeData(t.data,this.synth.ac.destination),this.outNode=t.data.anode):this.synth.initNodeData(t.data,e)}findFreeSpot(){let t=0;const e=this.gr.canvas.width,n=this.gr.canvas.height;let i=e/2,s=n/2;for(let o=10;o<e-this.nw;o+=10)for(let e=10;e<n-this.nh;e+=10){const n=this.dist2nearestNode(o,e);n>t&&n<3*this.nw&&(i=o,s=e,t=n)}return{x:i,y:s}}dist2nearestNode(t,e){let n=Number.MAX_VALUE;for(const i of this.gr.nodes){const s=t-i.x,o=e-i.y,a=Math.sqrt(s*s+o*o);a<n&&(n=a)}return n}initNodeDimensions(t){this.nw=t.element.outerWidth()||0,this.nh=t.element.outerHeight()||0}};class l extends o.a{constructor(t){super(),this.node=t}getInputs(){const t=[];for(const e of this.node.inputs)t.push(e.data);return t}}},function(t,e,n){"use strict";const i=16,s=20;e.a=class{constructor(t){if(this.nodes=[],this.lastId=0,!t.parentElement)return;this.nodeCanvas=$(t.parentElement),this.canvas=t;const e=t.getContext("2d");e&&(this.graphDraw=new class{constructor(t,e,n){this.arrowHeadLen=10,this.graph=t,this.gc=e,this.canvas=n,this.nodes=t.nodes}draw(){this.clearCanvas(),this.gc.lineWidth=2;for(const t of this.nodes)for(const e of t.inputs)this.drawArrow(e,t)}clearCanvas(){this.gc.clearRect(0,0,this.canvas.width,this.canvas.height)}drawArrow(t,e){const n=this.getNodeCenter(t),i=this.getNodeCenter(e);this.gc.strokeStyle=this.graph.handler.getArrowColor(t,e),this.gc.beginPath(),this.gc.moveTo(n.x,n.y),this.gc.lineTo(i.x,i.y),this.drawArrowTip(n,i),this.gc.closePath(),this.gc.stroke()}drawArrowTip(t,e){const n=t.x+.6*(e.x-t.x),i=t.y+.6*(e.y-t.y);let s=Math.atan2(e.y-t.y,e.x-t.x);this.gc.moveTo(n,i),this.gc.lineTo(n-this.arrowHeadLen*Math.cos(s-Math.PI/6),i-this.arrowHeadLen*Math.sin(s-Math.PI/6)),this.gc.moveTo(n,i),this.gc.lineTo(n-this.arrowHeadLen*Math.cos(s+Math.PI/6),i-this.arrowHeadLen*Math.sin(s+Math.PI/6))}getNodeCenter(t){return t.w=void 0!==t.w?t.w:t.element.outerWidth()||0,t.h=void 0!==t.h?t.h:t.element.outerHeight()||0,{x:t.x+t.w/2,y:t.y+t.h/2}}}(this,e,t),this.graphInteract=new class{constructor(t,e){this.dragging=!1,this.graph=t,this.gc=e,this.setupConnectHandler(e.canvas)}registerNode(t){t.element.draggable({containment:"parent",distance:5,stack:".node",drag:(e,n)=>{t.x=n.position.left,t.y=n.position.top,this.graph.draw()},start:(t,e)=>{this.dragging=!0,e.helper.css("cursor","move")},stop:(t,e)=>{e.helper.css("cursor","default"),this.dragging=!1}}),t.element.click(e=>{this.dragging||this.selectedNode!=t&&this.selectNode(t)})}selectNode(t){this.selectedNode&&this.selectedNode.element.removeClass("selected"),t.element.addClass("selected"),this.selectedNode=t,this.graph.handler.nodeSelected(t)}setupConnectHandler(t){if(!t)return;let e,n=!1;for(;null!=t&&t.tabIndex<0&&"body"!=t.nodeName.toLowerCase();)t=t.parentElement;t&&$(t).keydown(t=>{if(t.keyCode==s)return this.setGrid([20,20]);t.keyCode!=i||n||(e=this.getNodeFromDOM(this.getElementUnderMouse()))&&(this.graph.handler.canBeSource(e)?(n=!0,this.registerRubberBanding(e)):e.element.css("cursor","not-allowed"))}).keyup(t=>{if(t.keyCode==s)return this.setGrid(null);if(t.keyCode!=i)return;n=!1,this.deregisterRubberBanding();const o=this.getNodeFromDOM(this.getElementUnderMouse());o&&e!=o&&(e&&this.connectOrDisconnect(e,o),this.graph.draw())})}setGrid(t){$(this.graph.nodeCanvas).find(".node").draggable("option","grid",t)}connectOrDisconnect(t,e){this.graph.disconnect(t,e)||this.graph.connect(t,e)}getElementUnderMouse(){const t=$(":hover");if(t.length<=0)return null;const e=$(t.get(t.length-1));return e.hasClass("node")?e:e.parent().hasClass("node")?e.parent():null}registerRubberBanding(t){const e=this.graph.nodeCanvas.offset();if(!e)return;const n=new o(0,0,"");n.w=0,n.h=0,$(this.graph.nodeCanvas).on("mousemove",i=>{if(!i)return;let s=i.clientX||0,o=i.clientY||0;n.x=s-e.left;let a=document.scrollingElement.scrollTop;n.y=o-e.top+a,this.graph.draw(),this.gc.save(),this.gc.setLineDash([10]),this.graph.graphDraw.drawArrow(t,n),this.gc.restore()}),this.graph.nodeCanvas.css("cursor","crosshair"),this.graph.nodeCanvas.find(".node").css("cursor","crosshair");for(const e of this.graph.nodes)e==t||this.graph.handler.canConnect(t,e)||e.element.css("cursor","not-allowed")}deregisterRubberBanding(){this.graph.nodeCanvas.css("cursor",""),this.graph.nodeCanvas.find(".node").css("cursor","default"),this.graph.nodeCanvas.off("mousemove"),this.graph.graphDraw.draw()}getNodeFromDOM(t){if(!t)return null;for(const e of this.graph.nodes)if(e.element[0]==t[0])return e;return null}}(this,e),this.handler=new a)}addNode(t,e){t.id=this.lastId++,t.element=$("<div>").addClass("node").html(`<div class="node-text">${t.name}</div>`).css({left:t.x,top:t.y,cursor:"default"}),e&&t.element.addClass(e),this.nodeCanvas.append(t.element),this.nodes.push(t),this.graphInteract.registerNode(t),this.draw()}removeNode(t){const e=this.nodes.indexOf(t);if(e<0)return console.warn(`Node '${t.name}' is not a member of graph`);for(const e of this.nodes)t!=e&&(this.disconnect(t,e),this.disconnect(e,t));this.nodes.splice(e,1),t.element.remove(),this.handler.nodeRemoved(t),this.draw()}selectNode(t){this.graphInteract.selectNode(t)}connect(t,e){return!(!this.handler.canBeSource(t)||!this.handler.canConnect(t,e)||(e.addInput(t),this.handler.connected(t,e),0))}disconnect(t,e){return!!e.removeInput(t)&&(this.handler.disconnected(t,e),!0)}draw(){this.graphDraw.draw()}toJSON(){const t=[],e=[];for(const n of this.nodes){const i=[];for(const t of n.inputs)i.push(t.id);t.push({id:n.id,x:n.x,y:n.y,name:n.name,inputs:i,classes:this.getAppClasses(n)}),e.push(this.handler.data2json(n))}const n={nodes:t,nodeData:e};return this.handler.graphSaved(),n}fromJSON(t){for(;this.nodes.length>0;)this.removeNode(this.nodes[0]);this.lastId=0;for(const e of t.nodes){const t=new o(e.x,e.y,e.name);this.addNode(t),t.id=e.id,t.element.attr("class",e.classes)}const e=this.handler;this.handler=new a;for(let e=0;e<t.nodes.length;e++)for(const n of t.nodes[e].inputs){const t=this.nodeById(n);t&&this.connect(t,this.nodes[e])}this.handler=e;for(let e=0;e<t.nodes.length;e++)this.handler.json2data(this.nodes[e],t.nodeData[e]);for(const t of this.nodes)for(const e of t.inputs)this.handler.connected(e,t);this.draw(),this.handler.graphLoaded()}nodeById(t){for(const e of this.nodes)if(e.id===t)return e;return null}getAppClasses(t){const e=t.element[0].className.split(/\s+/),n=[];for(const t of e)"selected"!=t&&"ui-"!=t.substr(0,3)&&n.push(t);return n.join(" ")}};class o{constructor(t,e,n){this.inputs=[],this.x=t,this.y=e,this.name=n.replace(/<[^<]*>/g,t=>"<br>"==t?t:"")}addInput(t){this.inputs.push(t)}removeInput(t){const e=this.inputs.indexOf(t);return!(e<0)&&(this.inputs.splice(e,1),!0)}}e.b=o;class a{canBeSource(t){return!0}canConnect(t,e){return!0}connected(t,e){}disconnected(t,e){}nodeSelected(t){}nodeRemoved(t){}getArrowColor(t,e){return"black"}data2json(t){return{}}json2data(t,e){}graphLoaded(){}graphSaved(){}}},function(t,e,n){"use strict";function i(t,e,n,i,s){const a=$('<div class="slider-box">'),l=$('<input type="range" orient="vertical">').attr("min",0).attr("max",1).attr("step",.001).attr("value",o(i,e)),h=$('<input type="number">').attr("min",e.min||0).attr("max",e.max||1).attr("value",c(i,5));return a.append(h),a.append(l),a.append($("<span><br/>"+r(n)+"</span>")),t.append(a),l.on("input",t=>{const n=function(t,e){let n=e.min||0,i=e.max||1;return e.linear?n+t*(i-n):Object(u.c)(t,n,i)}(parseFloat(""+l.val()),e);h.val(c(n,5)),s(n)}),h.on("input",t=>{const n=parseFloat(""+h.val());isNaN(n)||(l.val(o(n,e)),s(n))}),a}function s(t,e,n,i){const s=$('<div class="choice-box">'),o=$("<select>").attr("size",e.length||2);for(const t of e){const e=$("<option>").text(t);t==n&&e.attr("selected","selected"),o.append(e)}return s.append(o),o.after("<br/><br/>"+i),t.append(s),o}function o(t,e){let n=e.min||0,i=e.max||1;return e.linear?(t-n)/(i-n):Object(u.b)(t,n,i)}function a(t,e){t.empty();for(const n of e)t.append("<option>"+n+"</option>")}function r(t){return t[0].toUpperCase()+t.substring(1)}function c(t,e){let n=""+t;return"."==(n=n.substr(0,e))[n.length-1]?n.substr(0,e-1):n}e.a=function(t,e){e.empty();const n=[];if(t.nodeDef.control&&t.controlParams){let i=function(t,e){if(!t.controlParams)return null;const n=s(e,t.controlParams,t.controlParam,"Controlling");return n.change(e=>{t.controlParam&&t.anode.disconnect(t.controlTarget[t.controlParam]),t.controlParam=""+n.val(),t.anode.connect(t.controlTarget[t.controlParam])}),n.parent()}(t,e);i&&n.push(i)}const o=Object.keys(t.nodeDef.params||{});if(!(o.length<=0)){for(const a of o)if(t.anode[a]instanceof AudioParam)n.push(function(t,e,n,s){const o=e.params[n],a=t[n];return a._value&&(a.value=a._value),i(s,o,n,a.value,t=>{a.value=t,a._value=t})}(t.anode,t.nodeDef,a,e));else{let o=function(t,e,n,o){const a=e.params[n];if(a.choices){const e=s(o,a.choices,t[n],r(n));return e.change(i=>{t[n]=e.val()}),e.parent()}return void 0!=a.min?i(o,a,n,t[n],e=>t[n]=e):"boolean"==typeof a.initial?function(t,e,n,i,s){const o=$('<div class="choice-box">'),a=$('<button class="btn btn-info" data-toggle="button" aria-pressed="false">');return o.append(a),a.after("<br/><br/>"+s),t.append(o),i[n]?(a.text("Enabled"),a.addClass("active"),a.attr("aria-pressed","true")):(a.text("Disabled"),a.removeClass("active"),a.attr("aria-pressed","false")),a.click(t=>{i[n]=!i[n],a.text(i[n]?"Enabled":"Disabled")}),o}(o,0,n,t,r(n)):a.phandler?d[a.phandler.uiRender](o,a,t,n,r(n)):null}(t.anode,t.nodeDef,a,e);o&&n.push(o)}!function(t,e){if(e.length<1)return;const n=t.width()||0,i=e[0].width()||0,s=(n-e.length*i)/(e.length+1);let o=s;for(const t of e)t.css({position:"relative",left:o}),o+=s}(e,n)}};var u=n(1),l=n(4),h=n(6);const d={renderBufferData:function(t,e,n,i,s){const o=$('<div class="choice-box">'),a=$('\n\t\t<span class="btn btn-primary upload">\n\t\t\t<input type="file">\n\t\t\tLoad&nbsp;\n\t\t\t<span class="glyphicon glyphicon-open" aria-hidden="true"></span>\n\t\t</span>');o.append(a),a.after("<br/><br/>"+s),t.append(o);let r=!0;return a.find("input").change(t=>{l.e(t,t=>{n._encoded=t,n.context.decodeAudioData(t,t=>{n._buffer=t,r=!1,h.b()})}),setTimeout(t=>{r&&h.e("Loading and decoding audio data...")},300)}),o},renderSoundBank:function(t,e,n,i,o){const r=s(t,[],"","Buffers");r.css({marginBottom:"10px",marginLeft:"-20px",width:"140px",height:"100px",overflowX:"auto"});const c=$('<div style="margin-bottom: -24px">\n\t\t<span class="btn btn-primary upload">\n\t\t\t<input type="file">\n\t\t\t<span class="glyphicon glyphicon-open" aria-hidden="true"></span>\n\t\t</span>\n\t\t&nbsp;&nbsp;&nbsp;\n\t\t<span class="btn btn-danger">\n\t\t\t<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>\n\t\t</span></div>');r.after(c);const u=n._buffers,h=n._encodedBuffers,d=n._names;return a(r,d),c.find("input").change(t=>{l.e(t,(t,e)=>{h.push(t),n.context.decodeAudioData(t,t=>u.push(t)),d.push(e.name),a(r,d)})}),c.find(".btn-danger").click(t=>{const e=d.indexOf(r.val());e<0||([h,u,d].forEach(t=>t.splice(e,1)),a(r,d))}),r.parent()}}},function(t,e,n){"use strict";var i=n(26),s=n(27),o=n(28),a=n(29),r=n(8);const c=8;e.a=class{constructor(t){this.synthUI=t,this.poly=!1;let e=new o.a($("#piano"));this.piano=e,e.noteOn=(t=>this.arpeggiator.sendNoteOn(t,1)),e.noteOff=(t=>this.arpeggiator.sendNoteOff(t,1)),e.polyOn=(()=>this.polyOn()),e.polyOff=(()=>this.polyOff());let n=this.setupPCKeyboard(e);n.baseNote=e.baseNote,e.octaveChanged=(t=>n.baseNote=t),this.setupEnvelopeAnimation(e),this.setupArpeggiator(e,t.synth.ac),this.setupMidiKeyboard(e)}setupPCKeyboard(t){let e=new i.a("#synth");return e.noteOn=(e=>{"INPUT"==document.activeElement.nodeName&&"range"!=document.activeElement.getAttribute("type")||(this.arpeggiator.sendNoteOn(e,1),t.displayKeyDown(e))}),e.noteOff=(e=>{this.arpeggiator.sendNoteOff(e,1),t.displayKeyUp(e)}),e}setupMidiKeyboard(t){let e=new s.a;e.noteOn=((e,n,i)=>{this.arpeggiator.sendNoteOn(e,1),t.displayKeyDown(e)}),e.noteOff=((e,n,i)=>{this.arpeggiator.sendNoteOff(e,1),t.displayKeyUp(e)})}setupEnvelopeAnimation(t){const e=this.synthUI.gr.handler.graphLoaded;this.synthUI.gr.handler.graphLoaded=function(){e.bind(this.synthUI.gr.handler)();let n=null;for(const t of this.synthUI.gr.nodes){const e=t.data;if("ADSR"==e.type){n=e.anode;break}}t.setEnvelope(n||{attack:0,release:0})}}setupArpeggiator(t,e){this.arpeggiator=new a.a(e),t.arpeggioChanged=((t,e,n)=>{this.arpeggiator.mode=e,this.arpeggiator.octaves=n,this.arpeggiator.bpm=t}),this.arpeggiator.noteOn=((t,e,n)=>this.noteOn(t,e,n)),this.arpeggiator.noteOff=((t,e,n)=>this.noteOff(t,e,n))}noteOn(t,e,n){this.lastNote=t;const i=this.piano.getPortamento();this.poly?(this.instrument.portamento.time=i,this.instrument.noteOn(t,e,n)):(this.synthUI.synth.portamento.time=i,this.synthUI.synth.noteOn(t,e,n))}noteOff(t,e,n){this.lastNote=0,this.poly?this.instrument.noteOff(t,e,n):this.synthUI.synth.noteOff(t,e,n)}polyOn(){this.lastNote&&this.noteOff(this.lastNote,1),this.poly=!0;const t=this.synthUI.gr.toJSON();this.instrument=new r.a(this.synthUI.synth.ac,t,c,this.synthUI.outNode)}polyOff(){this.poly=!1,this.instrument.close()}}},function(t,e,n){"use strict";const i="ZSXDCVGBHNJMQ2W3ER5T6Y7UI9O0P",s=36;e.a=class{constructor(t="body"){this.setupHandler(t),this.baseNote=s}setupHandler(t){const e={};$(t).on("keydown",t=>{let n=t.keyCode||0;if(e[n])return;if(t.metaKey||t.altKey||t.ctrlKey)return;e[n]=!0;const i=this.key2midi(n);i<0||this.noteOn(i)}).on("keyup",t=>{let n=t.keyCode||0;e[n]=!1;const i=this.key2midi(n);i<0||this.noteOff(i)})}key2midi(t){const e=i.indexOf(String.fromCharCode(t));return e<0?-1:this.baseNote+e}noteOn(t){}noteOff(t){}}},function(t,e,n){"use strict";e.a=class{constructor(){this.connected=!1,navigator.requestMIDIAccess&&navigator.requestMIDIAccess({sysex:!1}).then(t=>{if(t.inputs.size<=0)return;const e=t.inputs.values().next().value;e&&(e.onmidimessage=(t=>this.midiMessage(t)),this.connected=!0)})}midiMessage(t){const e=t.data,n=e[0]>>4,i=15&e[0],s=e[1],o=e[2];switch(n){case 9:this.noteOn(s,o,i);break;case 8:this.noteOff(s,o,i)}}noteOn(t,e,n){}noteOff(t,e,n){}}},function(t,e,n){"use strict";var i=n(6),s=n(1);const o=17,a=36,r=["","u","d","ud"],c=["-","&uarr;","&darr;","&uarr;&darr;"],u=3,l=15,h=480,d=0,f=1;class p{constructor(t=o){this.numWhites=t}createKeys(t){const e=[],n=t.width()||0,i=t.height()||0,s=parseFloat(t.css("padding-left")),o=parseFloat(t.css("padding-top")),a=n/this.numWhites+1,r=Math.round(2*a/3),c=Math.round(2*i/3);let u=0;for(let n=0;n<this.numWhites;n++){const s=$('<div class="piano-key">').css({width:a+"px",height:i+"px"});t.append(s),e[u++]=s,this.hasBlack(n)&&u++}u=0;let l=s-r/2;for(let n=0;n<this.numWhites-1;n++){if(l+=a-1,u++,!this.hasBlack(n))continue;const i=$('<div class="piano-key piano-black">').css({width:r+"px",height:c+"px",left:l+"px",top:o+"px"});t.append(i),e[u++]=i}return e}hasBlack(t){const e=t%7;return 2!=e&&6!=e}}e.a=class{constructor(t){this.arpeggio={mode:0,octave:1,bpm:60},this.baseNote=a,this.octave=3,this.poly=!1,this.envelope={attack:0,release:0};const e=new p;this.keys=e.createKeys(t);for(let t=0;t<this.keys.length;t++)this.registerKey(this.keys[t],t);this.controls=t.parent(),this.registerButtons(this.controls),this.portaSlider=this.controls.find(".portamento-box input")}registerKey(t,e){t.mousedown(n=>{const i=e+this.baseNote;this.displayKeyDown(t),this.noteOn(i),this.pressedKey=t}),t.mouseup(n=>{const i=e+this.baseNote;this.displayKeyUp(t),this.noteOff(i),this.pressedKey=null}),t.mouseout(n=>{if(t!=this.pressedKey)return;const i=e+this.baseNote;this.displayKeyUp(t),this.noteOff(i),this.pressedKey=null})}registerButtons(t){$("#prev-octave-but").click(t=>{this.octave--,this.updateOctave()}),$("#next-octave-but").click(t=>{this.octave++,this.updateOctave()});const e=t.find(".arpeggio-box input");e.on("input",t=>{this.arpeggio.bpm=Object(s.c)(parseFloat(""+e.val()),l,h),this.triggerArpeggioChange()});const n=t.find(".btn-arpeggio-ud");n.click(t=>this.changeArpeggioMode(n));const i=t.find(".btn-arpeggio-oct");i.click(t=>this.changeArpeggioOctave(i)),$("#poly-but").click(t=>this.togglePoly())}updateOctave(){$("#prev-octave-but").prop("disabled",this.octave<=1),$("#next-octave-but").prop("disabled",this.octave>=8),$("#octave-label").text("C"+this.octave),this.baseNote=a+12*(this.octave-3),this.octaveChanged(this.baseNote)}displayKeyDown(t){"number"==typeof t&&(t=this.midi2key(t)),t&&(!this.poly&&0==this.arpeggio.mode&&this.lastKey&&this.displayKeyUp(this.lastKey,!0),t.css("transition",`background-color ${this.envelope.attack}s linear`),t.addClass("piano-key-pressed"),this.lastKey=t)}displayKeyUp(t,e){if("number"==typeof t&&(t=this.midi2key(t)),!t)return;const n=e?0:this.envelope.release;t.css("transition",`background-color ${n}s linear`),t.removeClass("piano-key-pressed")}midi2key(t){return this.keys[t-this.baseNote]}setEnvelope(t){this.envelope=t}togglePoly(){if(this.poly=!this.poly,this.poly){const t=$("<div>").addClass("editor-cover");t.append("<p>You can use the PC keyboard to play notes<br><br>Synth editing is disabled in polyphonic mode</p>"),$("body").append(t),$("#poly-but").text("Poly"),i.g(!0),this.polyOn()}else $(".editor-cover").remove(),$("#poly-but").text("Mono"),i.g(!1),this.polyOff()}getPortamento(){const t=parseFloat(""+this.portaSlider.val());return Object(s.c)(t,d,f)}changeArpeggioMode(t){this.arpeggio.mode++,this.arpeggio.mode>=r.length&&(this.arpeggio.mode=0),t.html(c[this.arpeggio.mode]),this.triggerArpeggioChange()}changeArpeggioOctave(t){this.arpeggio.octave++,this.arpeggio.octave>u&&(this.arpeggio.octave=1),t.text(this.arpeggio.octave),this.triggerArpeggioChange()}triggerArpeggioChange(){this.arpeggioChanged(this.arpeggio.bpm,r[this.arpeggio.mode],this.arpeggio.octave)}toJSON(){return{portamento:this.getPortamento(),octave:this.octave,arpeggio:{bpm:this.arpeggio.bpm,mode:this.arpeggio.mode,octave:this.arpeggio.octave}}}fromJSON(t){t&&(t.portamento&&this.portaSlider.val(Object(s.b)(t.portamento,d,f)),t.octave&&(this.octave=t.octave,this.updateOctave()),t.arpeggio&&(this.arpeggio.bpm=t.arpeggio.bpm,this.arpeggio.mode=t.arpeggio.mode,this.arpeggio.octave=t.arpeggio.octave,this.controls.find(".arpeggio-box input").val(Object(s.b)(this.arpeggio.bpm,l,h)),this.controls.find(".btn-arpeggio-ud").html(c[this.arpeggio.mode]),this.controls.find(".btn-arpeggio-oct").text(this.arpeggio.octave),this.triggerArpeggioChange()))}noteOn(t){}noteOff(t){}polyOn(){}polyOff(){}octaveChanged(t){}arpeggioChanged(t,e,n){}}},function(t,e,n){"use strict";var i=n(7);e.a=class{constructor(t){this.backward=!1,this.noteOnTime=.75,this.mode="",this.octaves=1,this.bpm=60,this.notect=0,this.notes=new class{constructor(){this.notes=[]}length(){return this.notes.length}get(t){return this.notes[t]}add(t,e,n){const i=new s(t,e,n);for(let t=0;t<this.notes.length;t++)if(e<this.notes[t].noteToPlay)return void this.notes.splice(t,0,i);this.notes.push(i)}remove(t){this.notes=this.notes.filter(e=>e.note!=t)}},this.timer=new i.a(t,this.bpm)}get bpm(){return this._bpm}set bpm(t){this._bpm=t,this.timer&&(this.timer.bpm=t)}timerCB(t){if(0==this.mode.length)return;const e=this.notes.length();if(0==e)return;this.wrapCounter(e);const n=this.notes.get(this.notect);this.noteOn(n.noteToPlay,n.velocity,t),this.noteOff(n.noteToPlay,n.velocity,t+this.timer.noteDuration*this.noteOnTime),"u"==this.mode?this.notect++:"d"==this.mode?this.notect--:"ud"==this.mode&&(this.backward?this.notect--:this.notect++)}wrapCounter(t){this.notect>=t?"ud"!=this.mode?this.notect=0:(this.backward=!0,this.notect=t<2?0:t-2):this.notect<0&&("ud"!=this.mode?this.notect=t-1:(this.backward=!1,this.notect=t<2?0:1))}sendNoteOn(t,e){if(0==this.mode.length)return this.noteOn(t,e);const n=0==this.notes.length();this.notes.add(t,t,e),this.octaves>1&&this.notes.add(t,t+12,e),this.octaves>2&&this.notes.add(t,t+24,e),n&&this.timer.start(t=>this.timerCB(t))}sendNoteOff(t,e){0==this.mode.length&&this.noteOff(t,e),this.notes.remove(t),0==this.notes.length()&&(this.timerCB(0),this.timer.stop(),this.backward=!1,this.notect=0)}noteOn(t,e,n){}noteOff(t,e,n){}};class s{constructor(t,e,n){this.note=t,this.noteToPlay=e,this.velocity=n}}},function(t,e,n){"use strict";var i=n(6),s=n(4),o=n(1);const a=20;e.a=class{constructor(t){this.presetNum=0,this.synthUI=t,this.registerListeners(t.gr.canvas),this.loadPresets()}loadPresets(){this.presets=new Array(a);for(let t=0;t<a;t++)this.presets[t]=this.getEmptyPreset();$.get("js/presets.json",t=>{if(t instanceof Array){for(let e=0;e<a;e++)t[e]&&(this.presets[e]=t[e]);this.preset2synth()}})}getEmptyPreset(){return{name:"",nodes:[{id:0,x:500,y:180,name:"Out",inputs:[],classes:"node node-out"}],nodeData:[{type:"out",params:{}}]}}registerListeners(t){$("#save-but").click(t=>this.savePreset()),$("#load-file").on("change",t=>this.loadPreset(t)),$("#prev-preset-but").click(t=>this.changePreset(this.presetNum-1)),$("#next-preset-but").click(t=>this.changePreset(this.presetNum+1)),$(Object(o.a)(t)).keydown(t=>{"INPUT"==t.target.nodeName||i.d||(37==t.keyCode&&this.changePreset(this.presetNum-1),39==t.keyCode&&this.changePreset(this.presetNum+1))}),$("#preset-num").click(t=>this.togglePresetSelector());const e=$(".preset-selector select");e.change(t=>{let n=e.val();if(!n)return;const i=n.toString().split(":")[0];this.changePreset(parseInt(i,10)-1)})}togglePresetSelector(){const t=$(".preset-selector");if(t.toggle(),!t.is(":visible"))return;this.synth2preset();const e=t.find("select");e.empty(),e.focus();let n=0;for(const t of this.presets){const i=n==this.presetNum?" selected":"";n++,t.nodes.length>1&&e.append(`<option${i}>${n}: ${t.name}</option>`)}}changePreset(t){t<0?t=a-1:t>=a&&(t=0),this.synth2preset(),this.presetNum=t,this.preset2synth()}synth2preset(){const t=this.synthUI.gr.toJSON();let e=""+$("#preset-name").val();return t.name=e.trim(),t.modulatorType="synth",this.beforeSave(t),this.presets[this.presetNum]=t,t}preset2synth(){const t=this.presets[this.presetNum];this.afterLoad(t),$("#preset-num").text(this.presetNum+1),$("#preset-name").val(t.name),$("#node-params").empty(),this.synthUI.gr.fromJSON(t),this.selectBestNode()}selectBestNode(){const t=t=>this.synthUI.gr.nodes.filter(t)[0];let e=t(t=>"Filter"==t.data.type);e||(e=t(t=>"ADSR"==t.data.type)),e||(e=t(t=>0==t.data.anode.numberOfInputs)),e&&this.synthUI.gr.selectNode(e)}loadPreset(t){t&&s.f(t,t=>{try{const e=JSON.parse(t);if("synth"!=e.modulatorType)throw"Invalid file format";this.presets[this.presetNum]=e,this.preset2synth()}catch(t){console.error(t),i.a("Could not load synth: invalid file format","Load error")}})}savePreset(){const t=this.synth2preset(),e=JSON.stringify(t);s.c()?(0==t.name.length&&(t.name=""+this.presetNum),s.d(t.name+".json",e)):i.f("Copy the text below to the clipboard and save it to a local text file","Save preset",e,null)}beforeSave(t){}afterLoad(t){}}},function(t,e,n){"use strict";function i(){f++}function s(){if(--f<=0){for(let t of p)t();p=[]}}var o=n(7),a=n(32),r=n(13),c=n(33),u=n(14),l=n(9),h=n(17),d=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(a,r)}c((i=i.apply(t,e||[])).next())})};e.a=class{constructor(t,e,n){this.context=t,this.presets=e,this.synthUI=n,this.timer=new o.a(t,60,.2),this.timer.start(t=>Object(r.f)(this.timer,t))}instrument(t,e,n=4){if("string"==typeof t){let n=r.c[e||t];n&&n.shutdown()}let o=Object(h.a)(this,t,e,n);return e&&(o.name=e),r.c[o.name]=o,function(t){d(this,void 0,void 0,function*(){i(),yield t.initialize(),s()})}(o),o}effect(t,e){let n=Object(c.a)(this.context,t);return r.b[e||t]=n,n}track(t,e,n=!1){let i=new a.a(this.context,this.synthUI.outNode,this.timer);return i.loop=n,i.name=t,r.h[t]=i,i.callback=e,function(t){f<=0?t():p.push(t)}(()=>Object(r.e)(i)),this}loop_track(t,e){return this.track(t,e,!0)}scale(t,e,n){return Object(u.b)(t,e,n)}log(...t){return Object(l.e)(!0,!1,...t),this}log_enable(t=!0){return Object(l.b)(t),this}log_clear(){return Object(l.a)(),this}bpm(t){return void 0===t?this.timer.bpm:(this.timer.bpm=t,this)}stop(){return Object(r.a)(t=>t.stop()),this}pause(){return Object(r.a)(t=>t.pause()),this}continue(){return Object(r.a)(t=>t.continue()),this}reset(){return Object(r.a)(t=>{t._effect&&t._effect.input.disconnect(),t.delete()}),this}listen(t){return Object(r.d)(t),this}init(t){return d(this,void 0,void 0,function*(){return i(),yield t(),s(),this})}};let f=0,p=[]},function(t,e,n){"use strict";var i=n(13);class s{constructor(t,e,n){this.ac=t,this.out=e,this.timer=n,this.shouldStop=!1,this.stopped=!1,this._gain=t.createGain(),this._gain.connect(e),this.lastGain=this._gain.gain.value}mute(){return this.lastGain=this._gain.gain.value,this._gain.gain.value=1e-5,this}unmute(){return this._gain.gain.value=this.lastGain,this}gain(t,e){return t<1e-5&&(t=1e-5),void 0===e?this._gain.gain.value=t:this._gain.gain.exponentialRampToValueAtTime(t,this.ac.currentTime+e),this}stop(){return this.shouldStop=!0,this}pause(){return this.stopped=!0,this}continue(){return this.shouldStop=!1,this.stopped=!1,this}delete(){this.mute(),delete i.g[this.name],delete i.h[this.name]}}e.a=class extends s{constructor(){super(...arguments),this.notect=0,this.notes=[],this.time=0,this.latency=.2,this.loop=!1,this.loopCount=0,this.velocity=1,this._transpose=0,this.playing=!1}instrument(t){return this.playing||t.connect(this._gain),this.inst=t,this}effect(t){if(this.playing)return this;let e=this._effect?this._effect.output:this._gain;return e.disconnect(),e.connect(t.input),t.output.connect(this.out),this._effect=t,this}volume(t){return this.velocity=t,this}play(t=64,e,n){if(!this.inst)throw new Error("Must call instrument before playing a note or setting parameters");return this.notes.push({track:this,instrument:this.inst,number:t+this._transpose,time:this.time+this.latency,velocity:this.velocity,duration:e,options:n}),this}play_notes(t,e,n){void 0===e?e=[0]:"number"==typeof e&&(e=[e]);let i=e.ring();"number"==typeof n&&(n=[n]);let s=n?n.ring():void 0,o=t.ring();return this.repeat(t.length,t=>this.play(o.tick(),s?s.tick():void 0).sleep(i.tick())),this}transpose(t){return this._transpose=t,this}params(t){return this.play(0,void 0,t)}param(t,e){return this.params({instrument:this.inst,[t]:e})}sleep(t){return this.time+=60*t/this.timer.bpm,this}repeat(t,e){for(let n=0;n<t;n++)e(n);return this}}},function(t,e,n){"use strict";e.a=function(t,e){e.indexOf("/")<0&&(e="WebAudio/"+e);let[n,i]=e.split("/"),s=r[n];if(!s)throw new Error(`Effect "${e}" not found: unknown prefix "${s}"`);return s(t,i)};var i=n(34);class s{constructor(t,e){this.ac=t,this.name=e}param(t,e,n,i=!0){let s=this.getAudioParam(t);return void 0===e?s.value:(void 0===n?s.value=e:i?s.exponentialRampToValueAtTime(e,this.ac.currentTime+n):s.linearRampToValueAtTime(e,this.ac.currentTime+n),this)}paramNames(){let t=[];for(let e in this.input)this.input[e]instanceof AudioParam&&t.push(e);return t}getAudioParam(t){let e=this.input[t];if(!(e&&e instanceof AudioParam))throw new Error(`Parameter "${t}" not found in effect "${this.name}"`);return e}}class o extends s{constructor(t,e){super(t,e);let n=a[e];if(!n)throw new Error(`Effect "tuna/${e}" does not exist`);this.input=new n,this.output=this.input}paramNames(){let t=this.input,e=["bypass"];for(let n of Object.getOwnPropertyNames(t.defaults))e.push(n);return e}param(t,e,n,i=!0){let s=this.input;if(void 0===s[t])throw new Error(`Parameter "${t}" not found in effect "${this.name}"`);return void 0===e?s[t]:(void 0===n?s[t]=e:s.automate(t,e,n),this)}}let a,r={WebAudio:(t,e)=>new class extends s{constructor(t,e){super(t,e);let n="create"+e;if(!t[n])throw new Error(`Effect "${e}" does not exist`);this.input=t[n](),this.output=this.input}}(t,e),tuna:function(t,e){return a||(a=Object(i.a)(t)),new o(t,e)}}},function(t,e,n){"use strict";function i(t){if(!(this instanceof i))return new i(t);let e="undefined"==typeof window?{}:window;if(e.AudioContext||(e.AudioContext=e.webkitAudioContext),t||(console.log("tuna.js: Missing audio context! Creating a new context for you."),t=e.AudioContext&&new e.AudioContext),!t)throw new Error("Tuna cannot initialize because this environment does not support web audio.");!function(t){if(!0===t.__connectified__)return;let e=t.createGain(),n=Object.getPrototypeOf(Object.getPrototypeOf(e)),i=n.connect;n.connect=function(){let t=arguments[0];return arguments[0]=d.isPrototypeOf?d.isPrototypeOf(t)?t.input:t:t.input||t,i.apply(this,arguments),t},t.__connectified__=!0}(t),u=t,l=this}function s(t){return Math.max(0,Math.round(100*Math.pow(2,t/6))/100)}function o(t,e){let n,i,s=0,o=0,a=0,r=0;if(n=t.toExponential().match(/^.\.?(.*)e(.+)$/)||"",s=parseInt(n[2],10)-(n[1]+"").length,n=e.toExponential().match(/^.\.?(.*)e(.+)$/)||"",(o=parseInt(n[2],10)-(n[1]+"").length)>s&&(s=o),i=t%e,s<-100||s>20){a=Math.round(Math.log(i)/Math.log(10));return(i/(r=Math.pow(10,a))).toFixed(a-s)*r}return parseFloat(i.toFixed(-s))}function a(t){return 0===t?1:Math.abs(t)/t}function r(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function c(t,e){return void 0===t?e:t}e.a=i;let u,l,h=function(t,e){t.value=e},d=Object.create(null,{activate:{writable:!0,value:function(t){t?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(t)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(t){this._lastBypassValue!==t&&(this._bypass=t,this.activate(!t),this._lastBypassValue=t)}},connect:{value:function(t){this.output.connect(t)}},disconnect:{value:function(t){this.output.disconnect(t)}},connectInOrder:{value:function(t){let e=t.length-1;for(;e--;){if(!t[e].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",t[e]);t[e+1].input?t[e].connect(t[e+1].input):t[e].connect(t[e+1])}}},getDefaults:{value:function(){let t={};for(let e in this.defaults)t[e]=this.defaults[e].value;return t}},automate:{value:function(t,e,n,i){let s,o=i?~~(i/1e3):u.currentTime,a=n?~~(n/1e3):0,r=this.defaults[t],c=this[t];c?r.automatable?(n?(s="linearRampToValueAtTime",c.cancelScheduledValues(o),c.setValueAtTime(c.value,o)):s="setValueAtTime",c[s](e,a+o)):c=e:console.error("Invalid Property for "+this.name)}}}),f="float",p="boolean";i.prototype.Bitcrusher=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=u.createGain(),this.activateNode=u.createGain(),this.processor=u.createScriptProcessor(this.bufferSize,1,1),this.output=u.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);let e,n,i,s,o,a=0,r=0;this.processor.onaudioprocess=function(t){for(e=t.inputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(0),i=Math.pow(.5,this.bits),o=e.length,s=0;s<o;s++)(a+=this.normfreq)>=1&&(a-=1,r=i*Math.floor(e[s]/i+.5)),n[s]=r},this.bits=t.bits||this.defaults.bits.value,this.normfreq=c(t.normfreq,this.defaults.normfreq.value),this.bypass=t.bypass||!1},i.prototype.Bitcrusher.prototype=Object.create(d,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:"int"},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:"int"},bypass:{value:!1,automatable:!1,type:p},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:f}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(t){this.processor.bits=t}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(t){this.processor.normfreq=t}}}),i.prototype.Cabinet=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.convolver=this.newConvolver(t.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=c(t.makeupGain,this.defaults.makeupGain),this.bypass=t.bypass||!1},i.prototype.Cabinet.prototype=Object.create(d,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:f},bypass:{value:!1,automatable:!1,type:p}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=t}},newConvolver:{value:function(t){return new l.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),i.prototype.Chorus=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.attenuator=this.activateNode=u.createGain(),this.splitter=u.createChannelSplitter(2),this.delayL=u.createDelay(),this.delayR=u.createDelay(),this.feedbackGainNodeLR=u.createGain(),this.feedbackGainNodeRL=u.createGain(),this.merger=u.createChannelMerger(2),this.output=u.createGain(),this.lfoL=new l.LFO({target:this.delayL.delayTime,callback:h}),this.lfoR=new l.LFO({target:this.delayR.delayTime,callback:h}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=c(t.feedback,this.defaults.feedback.value),this.rate=c(t.rate,this.defaults.rate.value),this.delay=c(t.delay,this.defaults.delay.value),this.depth=c(t.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Chorus.prototype=Object.create(d,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:f},delay:{value:.0045,min:0,max:1,automatable:!1,type:f},depth:{value:.7,min:0,max:1,automatable:!1,type:f},rate:{value:1.5,min:0,max:8,automatable:!1,type:f},bypass:{value:!1,automatable:!1,type:p}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(t){this._delay=2*Math.pow(10,t)*2e-4,this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),i.prototype.Compressor=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.compNode=this.activateNode=u.createDynamicsCompressor(),this.makeupNode=u.createGain(),this.output=u.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=c(t.automakeup,this.defaults.automakeup.value),this.makeupGain=c(t.makeupGain,this.defaults.makeupGain.value),this.threshold=c(t.threshold,this.defaults.threshold.value),this.release=c(t.release,this.defaults.release.value),this.attack=c(t.attack,this.defaults.attack.value),this.ratio=t.ratio||this.defaults.ratio.value,this.knee=c(t.knee,this.defaults.knee.value),this.bypass=t.bypass||!1},i.prototype.Compressor.prototype=Object.create(d,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:f},release:{value:250,min:10,max:2e3,automatable:!0,type:f},makeupGain:{value:1,min:1,max:100,automatable:!0,type:f},attack:{value:1,min:0,max:1e3,automatable:!0,type:f},ratio:{value:4,min:1,max:50,automatable:!0,type:f},knee:{value:5,min:0,max:40,automatable:!0,type:f},automakeup:{value:!1,automatable:!1,type:p},bypass:{value:!1,automatable:!1,type:p}}},computeMakeup:{value:function(){let t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/4}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(t){this._automakeup=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(t){this.compNode.threshold.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(t){this.compNode.ratio.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(t){this.compNode.knee.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(t){this.compNode.attack.value=t/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(t){this.compNode.release.value=t/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=s(t)}}}),i.prototype.Convolver=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.convolver=u.createConvolver(),this.dry=u.createGain(),this.filterLow=u.createBiquadFilter(),this.filterHigh=u.createBiquadFilter(),this.wet=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=c(t.dryLevel,this.defaults.dryLevel.value),this.wetLevel=c(t.wetLevel,this.defaults.wetLevel.value),this.highCut=t.highCut||this.defaults.highCut.value,this.buffer=t.impulse||"../impulses/ir_rev_short.wav",this.lowCut=t.lowCut||this.defaults.lowCut.value,this.level=c(t.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=t.bypass||!1},i.prototype.Convolver.prototype=Object.create(d,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:f},lowCut:{value:20,min:20,max:22050,automatable:!0,type:f},dryLevel:{value:1,min:0,max:1,automatable:!0,type:f},wetLevel:{value:1,min:0,max:1,automatable:!0,type:f},level:{value:1,min:0,max:1,automatable:!0,type:f}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(t){this.filterLow.frequency.value=t}},highCut:{get:function(){return this.filterHigh.frequency},set:function(t){this.filterHigh.frequency.value=t}},level:{get:function(){return this.output.gain},set:function(t){this.output.gain.value=t}},dryLevel:{get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},wetLevel:{get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){let e=this.convolver,n=new XMLHttpRequest;t?(n.open("GET",t,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(n.status<300&&n.status>199||302===n.status)&&u.decodeAudioData(n.response,function(t){e.buffer=t},function(t){t&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)})},n.send(null)):console.log("Tuna.Convolver.setBuffer: Missing impulse path!")}}}),i.prototype.Delay=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.dry=u.createGain(),this.wet=u.createGain(),this.filter=u.createBiquadFilter(),this.delay=u.createDelay(10),this.feedbackNode=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=t.delayTime||this.defaults.delayTime.value,this.feedback=c(t.feedback,this.defaults.feedback.value),this.wetLevel=c(t.wetLevel,this.defaults.wetLevel.value),this.dryLevel=c(t.dryLevel,this.defaults.dryLevel.value),this.cutoff=t.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=t.bypass||!1},i.prototype.Delay.prototype=Object.create(d,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:f},feedback:{value:.45,min:0,max:.9,automatable:!0,type:f},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:f},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:f},dryLevel:{value:1,min:0,max:1,automatable:!0,type:f}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(t){this.delay.delayTime.value=t/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(t){this.feedbackNode.gain.value=t}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),i.prototype.Filter=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.filter=u.createBiquadFilter(),this.output=u.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=t.frequency||this.defaults.frequency.value,this.Q=t.resonance||this.defaults.Q.value,this.filterType=c(t.filterType,this.defaults.filterType.value),this.gain=c(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},i.prototype.Filter.prototype=Object.create(d,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:f},Q:{value:1,min:.001,max:100,automatable:!0,type:f},gain:{value:0,min:-40,max:40,automatable:!0,type:f},bypass:{value:!1,automatable:!1,type:p},filterType:{value:"lowpass",automatable:!1,type:"string"}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(t){this.filter.type=t}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(t){this.filter.Q.value=t}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(t){this.filter.gain.value=t}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),i.prototype.Gain=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.gainNode=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.gainNode),this.gainNode.connect(this.output),this.gain=c(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},i.prototype.Gain.prototype=Object.create(d,{name:{value:"Gain"},defaults:{writable:!0,value:{bypass:{value:!1,automatable:!1,type:p},gain:{value:1,automatable:!0,type:f}}},gain:{enumerable:!0,get:function(){return this.gainNode.gain},set:function(t){this.gainNode.gain.value=t}}}),i.prototype.MoogFilter=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=u.createGain(),this.activateNode=u.createGain(),this.processor=u.createScriptProcessor(this.bufferSize,1,1),this.output=u.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);let e,n,i,s,o,a,r,l;e=n=i=s=o=a=r=l=0;let h,d,f,p,m,g,v;this.processor.onaudioprocess=function(t){for(h=t.inputBuffer.getChannelData(0),d=t.outputBuffer.getChannelData(0),f=1.16*this.cutoff,v=f*f*.35013*(f*f),p=this.resonance*(1-.15*f*f),g=h.length,m=0;m<g;m++)h[m]-=l*p,h[m]*=v,o=h[m]+.3*e+(1-f)*o,e=h[m],a=o+.3*n+(1-f)*a,n=o,r=a+.3*i+(1-f)*r,i=a,l=r+.3*s+(1-f)*l,s=r,d[m]=l},this.cutoff=c(t.cutoff,this.defaults.cutoff.value),this.resonance=c(t.resonance,this.defaults.resonance.value),this.bypass=t.bypass||!1},i.prototype.MoogFilter.prototype=Object.create(d,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:"int"},bypass:{value:!1,automatable:!1,type:p},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:f},resonance:{value:3.5,min:0,max:4,automatable:!1,type:f}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(t){this.processor.cutoff=t}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(t){this.processor.resonance=t}}}),i.prototype.Overdrive=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.inputDrive=u.createGain(),this.waveshaper=u.createWaveShaper(),this.outputDrive=u.createGain(),this.output=u.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=c(t.drive,this.defaults.drive.value),this.outputGain=c(t.outputGain,this.defaults.outputGain.value),this.curveAmount=c(t.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=c(t.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=t.bypass||!1},i.prototype.Overdrive.prototype=Object.create(d,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:f,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:f,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:f},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:"int"}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(t){this._drive=t}},curveAmount:{get:function(){return this._curveAmount},set:function(t){this._curveAmount=t,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){this._outputGain=s(t)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(t){this._algorithmIndex=t,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(t,e,n){let i,s,o=2*(t=Math.min(t,.9999))/(1-t);for(i=0;i<e;i++)s=2*i/e-1,n[i]=(1+o)*s/(1+o*Math.abs(s))},function(t,e,n){let i,s,o=0;for(i=0;i<e;i++)s=2*i/e-1,o=(.5*Math.pow(s+1.4,2)-1)*o>=0?5.8:1.2,n[i]=r(o)},function(t,e,n){let i,s,o,a=1-t;for(i=0;i<e;i++)o=(s=2*i/e-1)<0?-Math.pow(Math.abs(s),a+.04):Math.pow(s,a),n[i]=r(2*o)},function(t,e,n){let i,s,o,r=0,c=1-t>.99?.99:1-t;for(i=0;i<e;i++)s=2*i/e-1,(o=Math.abs(s))<c?r=o:o>c?r=c+(o-c)/(1+Math.pow((o-c)/(1-c),2)):o>1&&(r=o),n[i]=a(s)*r*(1/((c+1)/2))},function(t,e,n){let i,s;for(i=0;i<e;i++)s=2*i/e-1,n[i]=s<-.08905?-.75*(1-Math.pow(1-(Math.abs(s)-.032857),12)+1/3*(Math.abs(s)-.032847))+.01:s>=-.08905&&s<.320018?s*s*-6.153+3.9375*s:.630035},function(t,e,n){let i,s,o=2+Math.round(14*t),a=Math.round(Math.pow(2,o-1));for(i=0;i<e;i++)s=2*i/e-1,n[i]=Math.round(s*a)/a}]}}),i.prototype.Panner=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.panner=u.createStereoPanner(),this.output=u.createGain(),this.activateNode.connect(this.panner),this.panner.connect(this.output),this.pan=c(t.pan,this.defaults.pan.value),this.bypass=t.bypass||!1},i.prototype.Panner.prototype=Object.create(d,{name:{value:"Panner"},defaults:{writable:!0,value:{bypass:{value:!1,automatable:!1,type:p},pan:{value:0,min:-1,max:1,automatable:!0,type:f}}},pan:{enumerable:!0,get:function(){return this.panner.pan},set:function(t){this.panner.pan.value=t}}}),i.prototype.Phaser=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.splitter=this.activateNode=u.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=u.createGain(),this.feedbackGainNodeR=u.createGain(),this.merger=u.createChannelMerger(2),this.filteredSignal=u.createGain(),this.output=u.createGain(),this.lfoL=new l.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new l.LFO({target:this.filtersR,callback:this.callback});let e=this.stage;for(;e--;)this.filtersL[e]=u.createBiquadFilter(),this.filtersR[e]=u.createBiquadFilter(),this.filtersL[e].type="allpass",this.filtersR[e].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=c(t.rate,this.defaults.rate.value),this.baseModulationFrequency=t.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=c(t.depth,this.defaults.depth.value),this.feedback=c(t.feedback,this.defaults.feedback.value),this.stereoPhase=c(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Phaser.prototype=Object.create(d,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:f},depth:{value:.6,min:0,max:1,automatable:!1,type:f},feedback:{value:.7,min:0,max:1,automatable:!1,type:f},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:f},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:f}}},callback:{value:function(t,e){for(let n=0;n<4;n++)t[n].frequency.value=e}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(t){this._baseModulationFrequency=t,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;let e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=o(e,2*Math.PI),this.lfoR._phase=e}}}),i.prototype.PingPongDelay=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.wetLevel=u.createGain(),this.stereoToMonoMix=u.createGain(),this.feedbackLevel=u.createGain(),this.output=u.createGain(),this.delayLeft=u.createDelay(10),this.delayRight=u.createDelay(10),this.activateNode=u.createGain(),this.splitter=u.createChannelSplitter(2),this.merger=u.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==t.delayTimeLeft?t.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==t.delayTimeRight?t.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==t.feedback?t.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==t.wetLevel?t.wetLevel:this.defaults.wetLevel.value,this.bypass=t.bypass||!1},i.prototype.PingPongDelay.prototype=Object.create(d,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(t){this._delayTimeLeft=t,this.delayLeft.delayTime.value=t/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(t){this._delayTimeRight=t,this.delayRight.delayTime.value=t/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:"int"},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:"int"},feedback:{value:.3,min:0,max:1,automatable:!1,type:f},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:f}}}}),i.prototype.Tremolo=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.splitter=this.activateNode=u.createChannelSplitter(2),this.amplitudeL=u.createGain(),this.amplitudeR=u.createGain(),this.merger=u.createChannelMerger(2),this.output=u.createGain(),this.lfoL=new l.LFO({target:this.amplitudeL.gain,callback:h}),this.lfoR=new l.LFO({target:this.amplitudeR.gain,callback:h}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.intensity=c(t.intensity,this.defaults.intensity.value),this.stereoPhase=c(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Tremolo.prototype=Object.create(d,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:f},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:f},rate:{value:5,min:.1,max:11,automatable:!1,type:f}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(t){this._intensity=t,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;let e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=o(e,2*Math.PI),this.lfoR.phase=e}}}),i.prototype.WahWah=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.activateNode=u.createGain(),this.envelopeFollower=new l.EnvelopeFollower({target:this,callback:function(t,e){t.sweep=e}}),this.filterBp=u.createBiquadFilter(),this.filterPeaking=u.createBiquadFilter(),this.output=u.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=c(t.automode,this.defaults.automode.value),this.resonance=t.resonance||this.defaults.resonance.value,this.sensitivity=c(t.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=c(t.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=t.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=c(t.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=t.bypass||!1},i.prototype.WahWah.prototype=Object.create(d,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:p},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:f},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:f},sweep:{value:.2,min:0,max:1,automatable:!1,type:f},resonance:{value:10,min:1,max:100,automatable:!1,type:f},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:f}}},automode:{get:function(){return this._automode},set:function(t){this._automode=t,t?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{writable:!0,value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep),this.filterPeaking.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep)}catch(t){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep},set:function(t){this._sweep=Math.pow(t>1?1:t<0?0:t,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=50*Math.pow(10,2*t),this._excursionFrequency=Math.min(u.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(t){this._excursionOctaves=t,this._excursionFrequency=Math.min(u.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(t){this._sensitivity=Math.pow(10,t)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(t){this._resonance=t,this.filterPeaking.Q.value=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),i.prototype.EnvelopeFollower=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.jsNode=this.output=u.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=c(t.attackTime,this.defaults.attackTime.value),this.releaseTime=c(t.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=t.target||{},this.callback=t.callback||function(){},this.bypass=t.bypass||!1},i.prototype.EnvelopeFollower.prototype=Object.create(d,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:f},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:f}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(t){this._attackTime=t,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(t){this._releaseTime=t,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(t){"function"==typeof t?this._callback=t:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(u.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null),this.activateCallback&&this.activateCallback(t)}},returnCompute:{value:function(t){return function(e){t.compute(e)}}},compute:{value:function(t){let e,n,i,s,o=t.inputBuffer.getChannelData(0).length,a=t.inputBuffer.numberOfChannels;if(n=i=s=0,a>1)for(s=0;s<o;++s)for(;n<a;++n)i+=(e=t.inputBuffer.getChannelData(n)[s])*e/a;else for(s=0;s<o;++s)i+=(e=t.inputBuffer.getChannelData(0)[s])*e;i=Math.sqrt(i),this._envelope<i?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*i):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*i),this._callback(this._target,this._envelope)}}}),i.prototype.LFO=function(t){t||(t=this.getDefaults()),this.input=u.createGain(),this.output=u.createScriptProcessor(256,1,1),this.activateNode=u.destination,this.frequency=c(t.frequency,this.defaults.frequency.value),this.offset=c(t.offset,this.defaults.offset.value),this.oscillation=c(t.oscillation,this.defaults.oscillation.value),this.phase=c(t.phase,this.defaults.phase.value),this.target=t.target||{},this.output.onaudioprocess=this.callback(t.callback||function(){}),this.bypass=t.bypass||!1},i.prototype.LFO.prototype=Object.create(d,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:f},offset:{value:.85,min:0,max:22049,automatable:!1,type:f},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:f},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:f}}},frequency:{get:function(){return this._frequency},set:function(t){this._frequency=t,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(t){this._offset=t}},oscillation:{get:function(){return this._oscillation},set:function(t){this._oscillation=t}},phase:{get:function(){return this._phase},set:function(t){this._phase=t}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){t?(this.output.connect(u.destination),this.activateCallback&&this.activateCallback(t)):this.output.disconnect()}},callback:{value:function(t){let e=this;return function(){e._phase+=e._phaseInc,e._phase>2*Math.PI&&(e._phase=0),t(e._target,e._offset+e._oscillation*Math.sin(e._phase))}}}}),i.toString=i.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}},function(t,e,n){"use strict";n.d(e,"a",function(){return i});let i=function(){return this.envelopes=[],this.onCacheFinish=null,this.onCacheProgress=null,this.afterTime=.05,this.nearZero=1e-6,this.queueWaveTable=function(t,e,n,i,s,o,a,r){a?a*=1:a=1;let c=this.findZone(t,n,s);if(!c.buffer)throw new Error("Preset is not ready: empty buffer");let u=c.originalPitch-100*c.coarseTune-c.fineTune,l=1*Math.pow(2,(100*s-u)/1200),h=(c.sampleRate,t.sampleRate,i);h<t.currentTime&&(h=t.currentTime);let d=o+this.afterTime,f=!0;(c.loopStart<1||c.loopStart>=c.loopEnd)&&(f=!1),f||d>c.buffer.duration/l&&(d=c.buffer.duration/l);let p=this.findEnvelope(t,e,h,d);if(this.setupEnvelope(t,p,c,a,h,d,o),p.audioBufferSourceNode=t.createBufferSource(),p.audioBufferSourceNode.playbackRate.value=l,r&&r.length>0){p.audioBufferSourceNode.playbackRate.setValueAtTime(l,i);for(let t=0;t<r.length;t++){let e=1*Math.pow(2,(100*r[t].pitch-u)/1200),n=i+r[t].when;p.audioBufferSourceNode.playbackRate.linearRampToValueAtTime(e,n)}}return p.audioBufferSourceNode.buffer=c.buffer,f?(p.audioBufferSourceNode.loop=!0,p.audioBufferSourceNode.loopStart=c.loopStart/c.sampleRate+c.delay,p.audioBufferSourceNode.loopEnd=c.loopEnd/c.sampleRate+c.delay):p.audioBufferSourceNode.loop=!1,p.audioBufferSourceNode.connect(p),p.audioBufferSourceNode.start(h,c.delay),p.audioBufferSourceNode.stop(h+d),p.when=h,p.duration=d,p.pitch=s,p.preset=n,p},this.noZeroVolume=function(t){return t>this.nearZero?t:this.nearZero},this.setupEnvelope=function(t,e,n,i,s,o,a){e.gain.setValueAtTime(this.noZeroVolume(0),t.currentTime);let r=0,c=0,u=a,l=n.ahdsr;o<u+this.afterTime&&(u=o-this.afterTime),l?l.length>0||(l=[{duration:0,volume:1},{duration:.5,volume:1},{duration:1.5,volume:.5},{duration:3,volume:0}]):l=[{duration:0,volume:1},{duration:u,volume:1}],e.gain.cancelScheduledValues(s),e.gain.setValueAtTime(this.noZeroVolume(l[0].volume*i),s);for(let t=0;t<l.length;t++)if(l[t].duration>0){if(l[t].duration+r>u){let n=c-(1-(l[t].duration+r-u)/l[t].duration)*(c-l[t].volume);e.gain.linearRampToValueAtTime(this.noZeroVolume(i*n),s+u);break}r+=l[t].duration,c=l[t].volume,e.gain.linearRampToValueAtTime(this.noZeroVolume(i*c),s+r)}e.gain.linearRampToValueAtTime(this.noZeroVolume(0),s+u+this.afterTime)},this.numValue=function(t,e){return"number"==typeof t?t:e},this.findEnvelope=function(t,e,n,i){let s=null;for(let e=0;e<this.envelopes.length;e++){let n=this.envelopes[e];if(this.expireEnvelope(n,t)){s=n;break}}return s||((s=t.createGain()).target=e,s.connect(e),s.cancel=function(e){void 0===e&&(e=t.currentTime),s.when+s.duration>t.currentTime&&(s.gain.cancelScheduledValues(e),s.gain.setTargetAtTime(1e-5,e,.1),s.when=e+1e-5,s.duration=0)},this.envelopes.push(s)),s},this.expireEnvelope=function(t,e){if(e.currentTime>t.when+t.duration+.1){try{t.audioBufferSourceNode.disconnect(),t.audioBufferSourceNode.stop(0),t.audioBufferSourceNode=null}catch(t){}return!0}return!1},this.expireEnvelopes=function(t){this.envelopes=this.envelopes.filter(e=>!this.expireEnvelope(e,t))},this.adjustPreset=function(t,e,n){e.bufferct=0;for(let i=0;i<e.zones.length;i++)this.adjustZone(t,e.zones[i],e,n)},this.adjustZone=function(t,e,n,i){if(e.buffer);else{if(e.delay=0,e.sample){let s=atob(e.sample);e.buffer=t.createBuffer(1,s.length/2,e.sampleRate);let o,a,r,c=e.buffer.getChannelData(0);for(let t=0;t<s.length/2;t++)o=s.charCodeAt(2*t),a=s.charCodeAt(2*t+1),o<0&&(o=256+o),a<0&&(a=256+a),(r=256*a+o)>=32768&&(r-=65536),c[t]=r/65536;n.bufferct++,n.bufferct>=n.zones.length&&i&&i()}else if(e.file){let s,o=e.file.length,a=new ArrayBuffer(o),r=new Uint8Array(a),c=atob(e.file);for(let t=0;t<c.length;t++)s=c.charCodeAt(t),r[t]=s;t.decodeAudioData(a,function(t){e.buffer=t,n.bufferct++,n.bufferct>=n.zones.length&&i&&i()})}e.loopStart=this.numValue(e.loopStart,0),e.loopEnd=this.numValue(e.loopEnd,0),e.coarseTune=this.numValue(e.coarseTune,0),e.fineTune=this.numValue(e.fineTune,0),e.originalPitch=this.numValue(e.originalPitch,6e3),e.sampleRate=this.numValue(e.sampleRate,44100),e.sustain=this.numValue(e.originalPitch,0)}},this.findZone=function(t,e,n){let i=null;for(let t=e.zones.length-1;t>=0&&!((i=e.zones[t]).keyRangeLow<=n&&i.keyRangeHigh+1>=n);t--);try{this.adjustZone(t,i)}catch(t){console.log("adjustZone",t)}return i},this.cancelQueue=function(t){for(let e=0;e<this.envelopes.length;e++){let n=this.envelopes[e];n.gain.cancelScheduledValues(0),n.gain.setValueAtTime(this.nearZero,t.currentTime),n.when=-1;try{n.audioBufferSourceNode.disconnect()}catch(t){console.log(t)}}},this}},function(t,e,n){"use strict";e.a=function(t){const e=monaco.KeyMod.Alt|monaco.KeyMod.CtrlCmd,n=monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift;let a=new class{constructor(t){this.editor=t,this.lightTheme=!0}runAllCode(){let t=this.editor.getModel();Object(i.b)(t.getValue()),Object(i.c)(t.getFullModelRange())}runSomeCode(){let t=this.editor.getSelection(),e=this.getRange(t);Object(i.b)(e),Object(i.c)(t)}stopAllTracks(){lc.reset()}toggleTheme(){this.lightTheme=!this.lightTheme,this.lightTheme?($("body").removeClass("dark"),monaco.editor.setTheme("vs"),$(".logo > img").attr("src","img/logo.svg")):($("body").addClass("dark"),monaco.editor.setTheme("vs-dark"),$(".logo > img").attr("src","img/logo-white.svg")),localStorage.walc_prefs_theme=this.lightTheme?"light":"dark"}reduceFont(){let t=this.getFontSize();t<=1||this.editor.updateOptions({fontSize:t-1})}enlargeFont(){this.editor.updateOptions({fontSize:this.getFontSize()+1})}showPrevBuffer(){Object(s.c)(this.editor)}showNextBuffer(){Object(s.b)(this.editor)}getRange(t){let e;return t.startLineNumber!=t.endLineNumber||t.startColumn!=t.endColumn?e=this.editor.getModel().getValueInRange(t):(e=this.editor.getModel().getLineContent(t.startLineNumber),t.startColumn=1,t.endColumn=e.length+1),"\n".repeat(t.startLineNumber-1)+e}getFontSize(){return this.editor.getConfiguration().fontInfo.fontSize}}(t);!function(t){let e=e=>t.editor.focus();$("#walc-run-all").click(n=>e(t.runAllCode())),$("#walc-run-sel").click(n=>e(t.runSomeCode())),$("#walc-stop").click(n=>e(t.stopAllTracks())),$("#walc-toggle-theme").click(n=>e(t.toggleTheme())),$("#walc-font-sm").click(n=>e(t.reduceFont())),$("#walc-font-lg").click(n=>e(t.enlargeFont()))}(a),function(t){"dark"==localStorage.walc_prefs_theme&&t.toggleTheme()}(a),$("#live-coding").on("drag dragstart dragend dragover dragenter dragleave drop",t=>{t.preventDefault(),t.stopPropagation()}).on("drop",t=>{let e=t.originalEvent.dataTransfer.files;Object(o.b)(e)}),t.addAction({id:"walc-run-all",label:"Run all code",keybindings:[e|monaco.KeyCode.Enter],contextMenuGroupId:"modulator",contextMenuOrder:1,run:()=>a.runAllCode()}),t.addAction({id:"walc-run-part",label:"Run current line or selection",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],contextMenuGroupId:"modulator",contextMenuOrder:2,run:()=>a.runSomeCode()}),t.addAction({id:"walc-stop-all",label:"Stop all tracks",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_DOT],contextMenuGroupId:"modulator",contextMenuOrder:3,run:()=>a.stopAllTracks()}),t.addAction({id:"walc-font-sm",label:"Reduce code font",keybindings:[e|monaco.KeyCode.US_COMMA],contextMenuGroupId:"modulator",contextMenuOrder:4,run:()=>a.reduceFont()}),t.addAction({id:"walc-font-lg",label:"Enlarge code font",keybindings:[e|monaco.KeyCode.US_DOT],contextMenuGroupId:"modulator",contextMenuOrder:5,run:()=>a.enlargeFont()}),t.addAction({id:"walc-buffer-prev",label:"Previous code buffer",keybindings:[n|monaco.KeyCode.US_COMMA],run:()=>a.showPrevBuffer()}),t.addAction({id:"walc-buffer-next",label:"Next code buffer",keybindings:[n|monaco.KeyCode.US_DOT],run:()=>a.showNextBuffer()})};var i=n(16),s=n(18),o=n(17)},function(t,e,n){"use strict";function i(t,e){return e.tick_ct=t.tick_ct,e.tick_ct>=e.length&&(e.tick_ct=e.length-1),e}e.a=function(){Array.prototype.ring||(Array.prototype.ring=function(){return(new o).fromArray(this)})};var s=n(19);class o extends Array{constructor(){super(...arguments),this.tick_ct=0}tick(){let t=this[this.tick_ct];return this.tick_ct++,this.tick_ct>=this.length&&(this.tick_ct=0),t}choose(){return this[s.a.integer(0,this.length-1)]}fromArray(t){for(let e of t)this.push(e);return this}toArray(){return new Array(...this)}clone(){return i(this,this.toArray().ring())}reverse(){return i(this,this.toArray().reverse().ring())}sort(t){return i(this,this.toArray().sort(t).ring())}shuffle(){let t=this.clone();for(let e=t.length-1;e>0;e--){let n=s.a.integer(0,e),i=t[e];t[e]=t[n],t[n]=i}return i(this,t)}take(t){return i(this,this.slice(0,t))}drop(t){return i(this,this.slice(t))}butlast(){return this.take(this.length-1)}drop_last(t){return this.take(this.length-t)}take_last(t){return this.drop(this.length-t)}stretch(t){let e=new o;for(let n of this)for(let i=0;i<t;i++)e.push(n);return i(this,e)}repeat(t){let e=new o;for(let n=0;n<t;n++)for(let t of this)e.push(t);return i(this,e)}mirror(){return i(this,this.concat(this.reverse()))}reflect(){return i(this,this.concat(this.reverse().drop(1)))}scale(t){let e=this.clone();for(let n=0;n<e.length;n++)e[n]*=t;return i(this,e)}transpose(t){let e=this.clone();for(let n=0;n<e.length;n++)e[n]+=t;return i(this,e)}toString(){let t=[];for(let e of this)t.push(e.toString());return t[this.tick_ct]=">"+t[this.tick_ct]+"<","("+t.join(", ")+")"}}},function(t,e,n){var i=n(39),s=n(40),o=n(41),a=n(42),r=n(43),c=n(44),u=n(45);u.alea=i,u.xor128=s,u.xorwow=o,u.xorshift7=a,u.xor4096=r,u.tychei=c,t.exports=u},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function r(t,e){var n=new function(t){var e=this,n=function(){var t=4022871197;return function(e){e=e.toString();for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)}}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}(t),i=e&&e.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.alea=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function r(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.xor128=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function r(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.xorwow=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function r(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,i=e.x,s=e.i;return t=i[s],t^=t>>>7,n=t^t<<24,t=i[s+1&7],n^=t^t>>>10,t=i[s+3&7],n^=t^t>>>3,t=i[s+4&7],n^=t^t<<7,t=i[s+7&7],t^=t<<13,n^=t^t<<9,i[s]=n,e.i=s+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&(i.x&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.xorshift7=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function r(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,i=e.w,s=e.X,o=e.i;return e.w=i=i+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,s,o,a,r=[],c=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,c=Math.max(c,e.length)),s=0,o=-32;o<c;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(a=a+1640531527|0,s=0==(n=r[127&o]^=i+a)?s+1:0);for(s>=128&&(r[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)i=r[s+34&127],n=r[s=s+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,r[s]=i^n;t.w=a,t.X=r,t.i=s}(e,t)}(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&(i.X&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.xor4096=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){(function(t){var i;!function(t,s,o){function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function r(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}s&&s.exports?s.exports=r:n(0)&&n(3)?void 0===(i=function(){return r}.call(e,n,e,s))||(s.exports=i):this.tychei=r}(0,"object"==typeof t&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){var i;!function(s,o){function a(t,e,n){var i=[],a=u(c((e=1==e?{entropy:!0}:e||{}).entropy?[t,l(s)]:null==t?function(){try{var t;return h&&(t=h.randomBytes)?t=t(f):(t=new Uint8Array(f),(d.crypto||d.msCrypto).getRandomValues(t)),l(t)}catch(t){var e=d.navigator,n=e&&e.plugins;return[+new Date,d,n,d.screen,l(s)]}}():t,3),i),_=new function(t){var e,n=t.length,i=this,s=0,o=i.i=i.j=0,a=i.S=[];n||(t=[n++]);for(;s<f;)a[s]=s++;for(s=0;s<f;s++)a[s]=a[o=y&o+t[s%n]+(e=a[s])],a[o]=e;(i.g=function(t){for(var e,n=0,s=i.i,o=i.j,a=i.S;t--;)e=a[s=y&s+1],n=n*f+a[y&(a[s]=a[o=y&o+e])+(a[o]=e)];return i.i=s,i.j=o,n})(f)}(i),w=function(){for(var t=_.g(p),e=g,n=0;t<v;)t=(t+n)*f,e*=f,n=_.g(1);for(;t>=b;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|_.g(4)},w.quick=function(){return _.g(4)/4294967296},w.double=w,u(l(_.S),s),(e.pass||n||function(t,e,n,i){return i&&(i.S&&r(i,_),t.state=function(){return r(_,{})}),n?(o[m]=t,e):t})(w,a,"global"in e?e.global:this==o,e.state)}function r(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function c(t,e){var n,i=[],s=typeof t;if(e&&"object"==s)for(n in t)try{i.push(c(t[n],e-1))}catch(t){}return i.length?i:"string"==s?t:t+"\0"}function u(t,e){for(var n,i=t+"",s=0;s<i.length;)e[y&s]=y&(n^=19*e[y&s])+i.charCodeAt(s++);return l(e)}function l(t){return String.fromCharCode.apply(0,t)}var h,d=this,f=256,p=6,m="random",g=o.pow(f,p),v=o.pow(2,52),b=2*v,y=f-1;if(o["seed"+m]=a,u(o.random(),s),"object"==typeof t&&t.exports){t.exports=a;try{h=n(46)}catch(t){}}else void 0===(i=function(){return a}.call(e,n,e,t))||(t.exports=i)}([],Math)},function(t,e){},function(t,e,n){"use strict";function i(){const t=location.hash||a;$("#page > div").hide(),$(t).show().css("outline","none").focus(),o&&$(document).trigger("route:hide",o),$(document).trigger("route:show",t),o=t,window.scrollTo(0,0)}function s(t){return new Promise(e=>{$.get(t+".html",n=>{$("#"+t).empty().append(n),e()})})}e.a=function(t){return window.onhashchange=i,a=t,i(),Promise.all([s("live-coding"),s("synth")])};let o,a}]);